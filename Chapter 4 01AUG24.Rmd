---
title: "R Notebook"
output: html_notebook
editor_options: 
  chunk_output_type: console
---
#package loading
```{r}
pacman::p_load("stringr","gplots","ggplot2","ComplexHeatmap", "limma", "edgeR", "tibble", "Homo.sapiens", "dplyr", "tidyr", "readr", "circlize", "RColorBrewer", "dendextend", "openxlsx","writexl","AnnotationDbi", "clusterProfiler", "org.Hs.eg.db", "tibble","statmod","dotplot","ggbio","moanin","shiny", "Mfuzz", "maSigPro","ggupset", "enrichplot", "VennDiagram", "ComplexUpset", "UpSetR", "gridExtra", "gridtext", "enrichR", "ggpubr","pracma", "ggh4x","eulerr", "marray", "ggplotify", "corrplot", "cowplot", "forcats", "biomaRt", "DESeq2", "ggpattern", "ssizeRNA", "Polychrome", "broom", "emmeans", "ggsignif", "multcomp", "CGPfunctions", "pwr", "gtable", "extrafont", "nlme", "ggtext", "drc", "export", "rstatix")
```

#read-in of data
```{r}
chapter4results <- openxlsx::read.xlsx("data/Chapter4code.xlsx")
chapter4results$TIME <- factor(chapter4results$TIME, levels = c("PRE", "POST"))
```

#Performance metrics (Fig 4.3B)
```{r}
#filter out those who did not complete the measurements
chapter4resultsfilterWPEAK <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(WPEAK)) | 
         !(any(TIME == "POST") & any(is.na(WPEAK))))

chapter4resultsfilterWPEAK <- subset(chapter4resultsfilterWPEAK, select = c("ID", "SEX", "TIME", "WPEAK"))

#make each set of data plotted in the right spot
chapter4resultsfilterWPEAK$TIME <- factor(chapter4resultsfilterWPEAK$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterWPEAK$interaction_SEX_TIME <- interaction(chapter4resultsfilterWPEAK$SEX, chapter4resultsfilterWPEAK$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistics for bars on graph
summary_statsWPEAK <- chapter4resultsfilterWPEAK %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(WPEAK),
            sd_value = sd(WPEAK, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultWPEAK <- aov(WPEAK ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterWPEAK)
anovaWPEAK <- summary(anova_resultWPEAK)
anovaWPEAK <- as.data.frame(anovaWPEAK$`Error: ID:TIME`[[1]])
twowaypvalueWPEAK <- anovaWPEAK["SEX:TIME", "Pr(>F)"]


#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsWPEAK <- emmeans(anova_resultWPEAK, ~ TIME | SEX) 
multiplecomparisonsWPEAK <- summary(pairs(multiplecomparisonsWPEAK), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsWPEAK$p.value[multiplecomparisonsWPEAK$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsWPEAK$p.value[multiplecomparisonsWPEAK$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelWPEAK <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelWPEAK <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelWPEAK <- round(twowaypvalueWPEAK, 3)

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsWPEAK <- max(chapter4resultsfilterWPEAK$WPEAK) * 1.6

y_positionFcomparisonWPEAK <- max(chapter4resultsfilterWPEAK$WPEAK[chapter4resultsfilterWPEAK$SEX == "F"]) * 1.2

y_positionMcomparisonWPEAK <- max(chapter4resultsfilterWPEAK$WPEAK[chapter4resultsfilterWPEAK$SEX == "M"]) * 1.2

y_positionanovaWPEAK <- max(chapter4resultsfilterWPEAK$WPEAK) * 1.5

Wpeak <- expression(paste(Ẇ[max]))

#plot of Wpeak
ggplot(data=chapter4resultsfilterWPEAK, aes(x=interaction_SEX_TIME, y=WPEAK)) +
  geom_bar(data = summary_statsWPEAK,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsWPEAK,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterWPEAK,
            aes(x = interaction_SEX_TIME, y = WPEAK, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =bquote(Ẇ[max]~"(Watts)")) +
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(Wpeak) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
   scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 700),breaks = seq(0, 700, by = 100)) +
  geom_signif(
              y_position = y_positionFcomparisonWPEAK, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelWPEAK,
              tip_length = 0, family = "sans", size=1, textsize=8) +
   geom_signif(
              y_position = y_positionMcomparisonWPEAK, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelWPEAK,
              tip_length = 0, family = "sans", size=1, textsize=8) +
  geom_signif(
              y_position = y_positionanovaWPEAK, xmin = c(1.5), xmax = (3.5),
              annotation = anovasignificance_levelWPEAK,
              tip_length = 0, family = "sans", size=1, textsize=6)

#filter out those who did not complete the measurements
chapter4resultsfilterWLT <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(WLT)) | 
         !(any(TIME == "POST") & any(is.na(WLT))))

#make each set of data plotted in the right spot
chapter4resultsfilterWLT$TIME <- factor(chapter4resultsfilterWLT$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterWLT$interaction_SEX_TIME <- interaction(chapter4resultsfilterWLT$SEX, chapter4resultsfilterWLT$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistics for bars on graph
summary_statsWLT <- chapter4resultsfilterWLT %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(WLT),
            sd_value = sd(WLT, na.rm = TRUE))

# performing two-way ANOVA and extracting the interaction p-value
anova_resultWLT <- aov(WLT ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterWLT)
anovaWLT <- summary(anova_resultWLT)
anovaWLT <- as.data.frame(anovaWLT$`Error: ID:TIME`[[1]])
twowaypvalueWLT <- anovaWLT["SEX:TIME", "Pr(>F)"]

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsWLT <- emmeans(anova_resultWLT, ~ TIME | SEX)
multiplecomparisonsWLT <- summary(pairs(multiplecomparisonsWLT), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsWLT$p.value[multiplecomparisonsWLT$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsWLT$p.value[multiplecomparisonsWLT$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelWLT <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelWLT <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelWLT <- round(twowaypvalueWLT,3)

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsWLT <- max(chapter4resultsfilterWLT$WLT) * 1.6

y_positionFcomparisonWLT <- max(chapter4resultsfilterWLT$WLT[chapter4resultsfilterWLT$SEX == "F"]) * 1.2

y_positionMcomparisonWLT <- max(chapter4resultsfilterWLT$WLT[chapter4resultsfilterWLT$SEX == "M"]) * 1.2

y_positionanovaWLT <- max(chapter4resultsfilterWLT$WLT) * 1.5

Wlt <- expression(paste(Ẇ[LT]))

#plot of WLT
ggplot(data=chapter4resultsfilterWLT, aes(x=interaction_SEX_TIME, y=WLT)) +
  geom_bar(data = summary_statsWLT,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsWLT,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterWLT,
            aes(x = interaction_SEX_TIME, y = WLT, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y = bquote(Ẇ[LT]~"(Watts)")) +
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(Wlt) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 450),breaks = seq(0, 450, by = 50)) +
  geom_signif(
              y_position = y_positionFcomparisonWLT, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelWLT, tip_length = 0, family = "sans", size=1, textsize=8) +
  geom_signif(
              y_position = y_positionMcomparisonWLT, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelWLT, tip_length = 0, family = "sans", size=1, textsize=8) +
  geom_signif(
              y_position = y_positionanovaWLT, xmin = c(1.5), xmax = (3.5),
              annotation = anovasignificance_levelWLT, tip_length = 0, family = "sans", size=1, textsize=6)

#filter out those who did not complete the measurements
chapter4resultsfilterVO2 <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(VO2)) | 
         !(any(TIME == "POST") & any(is.na(VO2))))

#make each set of data plotted in the right spot
chapter4resultsfilterVO2$TIME <- factor(chapter4resultsfilterVO2$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterVO2$interaction_SEX_TIME <- interaction(chapter4resultsfilterVO2$SEX, chapter4resultsfilterVO2$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistics for bars on graph
summary_statsVO2 <- chapter4resultsfilterVO2 %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(VO2),
            sd_value = sd(VO2, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultVO2 <- aov(VO2 ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterVO2)
anovaVO2 <- summary(anova_resultVO2)
anovaVO2 <- as.data.frame(anovaVO2$`Error: ID:TIME`[[1]])
twowaypvalueVO2 <- anovaVO2["SEX:TIME", "Pr(>F)"]

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsVO2 <- emmeans(anova_resultVO2, ~ TIME | SEX)
multiplecomparisonsVO2 <- summary(pairs(multiplecomparisonsVO2), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsVO2$p.value[multiplecomparisonsVO2$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsVO2$p.value[multiplecomparisonsVO2$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelVO2 <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelVO2 <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelVO2 <- ifelse(twowaypvalueVO2 <= 0.05, 
                             ifelse(twowaypvalueVO2 <= 0.001, "***", 
                                    ifelse(twowaypvalueVO2 <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsVO2 <- max(chapter4resultsfilterVO2$VO2) * 1.6

y_positionFcomparisonVO2 <- max(chapter4resultsfilterVO2$VO2[chapter4resultsfilterVO2$SEX == "F"]) * 1.2

y_positionMcomparisonVO2 <- max(chapter4resultsfilterVO2$VO2[chapter4resultsfilterVO2$SEX == "M"]) * 1.2

y_positionanovaVO2 <- max(chapter4resultsfilterVO2$VO2) * 1.5

Vo2 <- expression(paste(VO[2*peak]))

#plot of VO2
ggplot(data=chapter4resultsfilterVO2, aes(x=interaction_SEX_TIME, y=VO2)) +
  geom_bar(data = summary_statsVO2,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsVO2,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterVO2,
            aes(x = interaction_SEX_TIME, y = VO2, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y = bquote(VO[2]*"peak (mL•min"^"-1"*"•kg"^"-1"*")")) +
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(Vo2) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 80),breaks = seq(0, 80, by = 10)) +
      geom_signif(
              y_position = y_positionFcomparisonVO2, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelVO2, tip_length = 0, family = "sans", size=1, textsize=8) +
   geom_signif(
              y_position = y_positionMcomparisonVO2, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelVO2, tip_length = 0, family = "sans", size=1, textsize=8) +
  geom_signif(
              y_position = y_positionanovaVO2, xmin = c(1.5), xmax = (3.5),
              annotation = anovasignificance_levelVO2, tip_length = 0, family = "sans", size=1, textsize=8)


#create legend
colors <- c("#e3b3e0", "#94e2eb")
labels <- c("Women", "Men")
grid.legend(labels = labels, pch = 21, gp = gpar(fill = colors, col="black", fontfamily = "sans", fontsize = 20))
```

#Training load (Fig 4.C & D)
```{r}
chapter4resultsfilterTRAININGLOAD <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(TRAININGLOAD)) | 
         !(any(TIME == "POST") & any(is.na(TRAININGLOAD))))

Chapter4resultsTRAININGLOAD <- chapter4results %>%
  group_by(ID) %>%
  summarize(TRAININGLOAD = mean(TRAININGLOAD, na.rm = FALSE),
            SEX = first(SEX)) %>%
              na.omit()

summary_statsChapter4resultsTRAININGLOAD <- Chapter4resultsTRAININGLOAD %>%
  group_by(SEX) %>%
  summarise(mean_value = mean(TRAININGLOAD),
            sd_value = sd(TRAININGLOAD, na.rm = TRUE))

data_male <- subset(Chapter4resultsTRAININGLOAD, SEX == "M")
data_female <- subset(Chapter4resultsTRAININGLOAD, SEX == "F")

# Perform t-test
t_test_result <- t.test(data_male$TRAININGLOAD, data_female$TRAININGLOAD)
ttestpval <- t_test_result$p.value

significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
comparesignificance_level <- ifelse(ttestpval <= 0.05, 
                             ifelse(ttestpval <= 0.001, "***", 
                                    ifelse(ttestpval <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsChapter4resultsTRAININGLOAD <- max(Chapter4resultsTRAININGLOAD$TRAININGLOAD) * 1.4

y_positioncomparisonTRAININGLOAD <- max(Chapter4resultsTRAININGLOAD$TRAININGLOAD) * 1.2

ggplot(data=Chapter4resultsTRAININGLOAD, aes(x=SEX, y=TRAININGLOAD)) +
  geom_bar(data = summary_statsChapter4resultsTRAININGLOAD ,
           aes(x=SEX, y = mean_value, fill = SEX),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M" = "#94e2eb", "F" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsChapter4resultsTRAININGLOAD,
           aes(x=SEX, ymin = mean_value - sd_value, ymax = mean_value + sd_value), inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = Chapter4resultsTRAININGLOAD,
            aes(x = SEX, y = TRAININGLOAD, fill = SEX), height = 0, width = 0.175,
             size = 3,
            shape = 21,
             colour = "black", alpha = 1.0,
            stroke = 1.5,
             show.legend = FALSE) +
  labs(y = expression("Training load (MJ)")) +
      scale_x_discrete(labels = c("M" = "Men", "F" = "Women")) +
  ggtitle("Training load") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 12.5),breaks = seq(0, 12.5, by = 2.5)) +
  geom_signif(
              y_position = y_positioncomparisonTRAININGLOAD, xmin = c(1), xmax = (2),
              annotation = comparesignificance_level, tip_length = 0, family = "sans", size=1, textsize=8) 


Chapter4results <- chapter4results %>%
  group_by(ID) %>%
  mutate(VO2change = (VO2[TIME == "POST"]) - (VO2[TIME == "PRE"]))

Chapter4results <- Chapter4results %>%
  group_by(ID) %>%
  summarize(TL = mean(TRAININGLOAD, na.rm = FALSE),
            VO2change = mean(VO2change, na.rm = FALSE),
            SEX = first(SEX)) %>%
              na.omit()

Chapter4results <- Chapter4results  %>%
  group_by(ID) %>%
  mutate(adjVO2change = (VO2change/TL))

summary_statsChapter4results <- Chapter4results %>%
  group_by(SEX) %>%
  summarise(mean_value = mean(adjVO2change),
            sd_value = sd(adjVO2change, na.rm = TRUE))

data_male <- subset(Chapter4results, SEX == "M")
data_female <- subset(Chapter4results, SEX == "F")

# Perform t-test
t_test_result <- t.test(data_male$adjVO2change, data_female$adjVO2change)
ttestpval <- t_test_result$p.value

significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
comparesignificance_level <- round(ttestpval,3)

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsChapter4results <- max(Chapter4results$adjVO2change) * 1.4

y_positioncomparison <- max(Chapter4results$adjVO2change) * 1.2

adjvo2title <- expression(paste("Change in VO"[2*peak]*"  normalised by training load"))

ggplot(data=Chapter4results, aes(x=SEX, y=adjVO2change)) +
  geom_bar(data = summary_statsChapter4results ,
           aes(x=SEX, y = mean_value, fill = SEX),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M" = "#94e2eb", "F" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsChapter4results,
           aes(x=SEX, ymin = mean_value - sd_value, ymax = mean_value + sd_value), inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = Chapter4results,
            aes(x = SEX, y = adjVO2change, fill = SEX), height = 0, width = 0.175,
             size = 3,
            shape = 21,
             colour = "black", alpha = 1.0,
            stroke = 1.5,
             show.legend = FALSE) +
  labs(y = expression(atop("Change in VO "[2*peak]*" (mL•min"^"-1"*"•kg"^"-1"*")", "normalised by training load (MJ)"))) +
  scale_x_discrete(labels = c("M" = "Men", "F" = "Women")) +
  ggtitle(adjvo2title) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 4),breaks = seq(0, 4, by = 0.5)) +
  geom_signif(
              y_position = y_positioncomparison, xmin = c(1), xmax = (2),
              annotation = comparesignificance_level, tip_length = 0, family = "sans", size=1, textsize=6) 
```

#Mitochondrial protein yield (Fig 4.4B)
```{r}
chapter4resultsfilterMITOPROTEIN <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(MITOPROTEIN)) | 
         !(any(TIME == "POST") & any(is.na(MITOPROTEIN))))

#make each set of data plotted in the right spot
chapter4resultsfilterMITOPROTEIN$TIME <- factor(chapter4resultsfilterMITOPROTEIN$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterMITOPROTEIN$interaction_SEX_TIME <- interaction(chapter4resultsfilterMITOPROTEIN$SEX, chapter4resultsfilterMITOPROTEIN$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiMITOPROTEIN for bars on graph
summary_statsMITOPROTEIN <- chapter4resultsfilterMITOPROTEIN %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(MITOPROTEIN),
            sd_value = sd(MITOPROTEIN, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultMITOPROTEIN <- aov(MITOPROTEIN ~ SEX * TIME + Error(ID/TIME),
                               data = chapter4resultsfilterMITOPROTEIN)
summary(anova_resultMITOPROTEIN)
anovaMITOPROTEIN <- summary(anova_resultMITOPROTEIN)
anovaMITOPROTEIN <- as.data.frame(anovaMITOPROTEIN$`Error: ID:TIME`[[1]])
twowaypvalueMITOPROTEIN <- anovaMITOPROTEIN["SEX:TIME", "Pr(>F)"]
print(twowaypvalueMITOPROTEIN)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsMITOPROTEIN <- emmeans(anova_resultMITOPROTEIN, ~ TIME | SEX)
multiplecomparisonsMITOPROTEIN <- summary(pairs(multiplecomparisonsMITOPROTEIN), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsMITOPROTEIN$p.value[multiplecomparisonsMITOPROTEIN$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsMITOPROTEIN$p.value[multiplecomparisonsMITOPROTEIN$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelMITOPROTEIN <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelMITOPROTEIN <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelMITOPROTEIN <- ifelse(twowaypvalueMITOPROTEIN <= 0.05, 
                             ifelse(twowaypvalueMITOPROTEIN <= 0.001, "***", 
                                    ifelse(twowaypvalueMITOPROTEIN <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsMITOPROTEIN <- max(chapter4resultsfilterMITOPROTEIN$MITOPROTEIN) * 1.5

y_positionFcomparisonMITOPROTEIN <- max(chapter4resultsfilterMITOPROTEIN$MITOPROTEIN[chapter4resultsfilterMITOPROTEIN$SEX == "F"]) * 1.2

y_positionMcomparisonMITOPROTEIN <- max(chapter4resultsfilterMITOPROTEIN$MITOPROTEIN[chapter4resultsfilterMITOPROTEIN$SEX == "M"]) * 1.2

y_positionanovaMITOPROTEIN <- max(chapter4resultsfilterMITOPROTEIN$MITOPROTEIN) * 1.5

#plot of MITOPROTEIN
ggplot(data=chapter4resultsfilterMITOPROTEIN, aes(x=interaction_SEX_TIME, y=MITOPROTEIN)) +
  geom_bar(data = summary_statsMITOPROTEIN,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsMITOPROTEIN,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterMITOPROTEIN,
            aes(x = interaction_SEX_TIME, y = MITOPROTEIN, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression("Mitochondrial protein yield (µg•mg"^-1*" frozen muscle")) +   
       scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("Mitochondrial protein yield") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 18 ),breaks = seq(0, 18, by = 3)) +
    geom_signif(
              y_position = y_positionFcomparisonMITOPROTEIN, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelMITOPROTEIN,
              tip_length = 0, family = "sans", size=1, textsize=8) +
   geom_signif(
              y_position = y_positionMcomparisonMITOPROTEIN, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelMITOPROTEIN,
              tip_length = 0, family = "sans", size=1, textsize=8)
```

#CS activity (4.4C)
```{r}
#filter out those who did not complete the measurements
chapter4resultsfilterCSACTIVE <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(CSACTIVE)) | 
         !(any(TIME == "POST") & any(is.na(CSACTIVE))))

#make each set of data plotted in the right spot
chapter4resultsfilterCSACTIVE$TIME <- factor(chapter4resultsfilterCSACTIVE$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCSACTIVE$interaction_SEX_TIME <- interaction(chapter4resultsfilterCSACTIVE$SEX, chapter4resultsfilterCSACTIVE$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiCSACTIVE for bars on graph
summary_statsCSACTIVE <- chapter4resultsfilterCSACTIVE %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CSACTIVE),
            sd_value = sd(CSACTIVE, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCSACTIVE <- aov(CSACTIVE ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCSACTIVE)
anovaCSACTIVE <- summary(anova_resultCSACTIVE)
anovaCSACTIVE <- as.data.frame(anovaCSACTIVE$`Error: ID:TIME`[[1]])
twowaypvalueCSACTIVE <- anovaCSACTIVE["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCSACTIVE)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCSACTIVE <- emmeans(anova_resultCSACTIVE, ~ TIME | SEX)
multiplecomparisonsCSACTIVE <- summary(pairs(multiplecomparisonsCSACTIVE), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCSACTIVE$p.value[multiplecomparisonsCSACTIVE$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCSACTIVE$p.value[multiplecomparisonsCSACTIVE$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCSACTIVE <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCSACTIVE <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCSACTIVE <- ifelse(twowaypvalueCSACTIVE <= 0.05, 
                             ifelse(twowaypvalueCSACTIVE <= 0.001, "***", 
                                    ifelse(twowaypvalueCSACTIVE <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCSACTIVE <- max(chapter4resultsfilterCSACTIVE$CSACTIVE) * 1.5

y_positionFcomparisonCSACTIVE <- max(chapter4resultsfilterCSACTIVE$CSACTIVE[chapter4resultsfilterCSACTIVE$SEX == "F"]) * 1.2

y_positionMcomparisonCSACTIVE <- max(chapter4resultsfilterCSACTIVE$CSACTIVE[chapter4resultsfilterCSACTIVE$SEX == "M"]) * 1.2

y_positionanovaCSACTIVE <- max(chapter4resultsfilterCSACTIVE$CSACTIVE) * 1.5

#plot of CSACTIVE
ggplot(data=chapter4resultsfilterCSACTIVE, aes(x=interaction_SEX_TIME, y=CSACTIVE)) +
  geom_bar(data = summary_statsCSACTIVE,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCSACTIVE,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCSACTIVE,
            aes(x = interaction_SEX_TIME, y = CSACTIVE, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
             show.legend = FALSE) + 
  labs(y =expression("Citrate synthase activity "(mol*"•"*h^-1*"•"*"kg protein"^-1))) +
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("Citrate synthase activity") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 15), breaks = seq(0, 15, by = 3)) +
  geom_signif(
              y_position = y_positionFcomparisonCSACTIVE, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelCSACTIVE,
              tip_length = 0, family = "sans", size=1, textsize=8) +
  geom_signif(
              y_position = y_positionMcomparisonCSACTIVE, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelCSACTIVE,
              tip_length = 0, family = "sans", size=1, textsize=8)

```

#Total OXPHOS protein content (Fig 4.4D)
```{r}
#filter out those who did not complete the measurements
chapter4resultsfilterOXPHOS <- chapter4results %>% 
  dplyr::filter(!is.na(CI) & !is.na(CII) & !is.na(CIII) & !is.na(CIV) & !is.na(CV))

chapter4resultsfilterOXPHOS <-  chapter4resultsfilterOXPHOS %>% group_by(ID, TIME) %>%
  mutate(OXPHOS = CI + CII + CIII + CIV + CV)

#make each set of data plotted in the right spot
chapter4resultsfilterOXPHOS$TIME <- factor(chapter4resultsfilterOXPHOS$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterOXPHOS$interaction_SEX_TIME <- interaction(chapter4resultsfilterOXPHOS$SEX, chapter4resultsfilterOXPHOS$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiOXPHOS for bars on graph
summary_statsOXPHOS <- chapter4resultsfilterOXPHOS %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(OXPHOS),
            sd_value = sd(OXPHOS, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultOXPHOS <- aov(OXPHOS ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterOXPHOS)
anovaOXPHOS <- summary(anova_resultOXPHOS)
anovaOXPHOS <- as.data.frame(anovaOXPHOS$`Error: ID:TIME`[[1]])
twowaypvalueOXPHOS <- anovaOXPHOS["SEX:TIME", "Pr(>F)"]
print(twowaypvalueOXPHOS)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsOXPHOS <- emmeans(anova_resultOXPHOS, ~ TIME | SEX)
multiplecomparisonsOXPHOS <- summary(pairs(multiplecomparisonsOXPHOS), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsOXPHOS$p.value[multiplecomparisonsOXPHOS$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsOXPHOS$p.value[multiplecomparisonsOXPHOS$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelOXPHOS <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelOXPHOS <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelOXPHOS <- ifelse(twowaypvalueOXPHOS <= 0.05, 
                             ifelse(twowaypvalueOXPHOS <= 0.001, "***", 
                                    ifelse(twowaypvalueOXPHOS <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsOXPHOS <- max(chapter4resultsfilterOXPHOS$OXPHOS) * 1.5

y_positionFcomparisonOXPHOS <- max(chapter4resultsfilterOXPHOS$OXPHOS[chapter4resultsfilterOXPHOS$SEX == "F"]) * 1.2

y_positionMcomparisonOXPHOS <- max(chapter4resultsfilterOXPHOS$OXPHOS[chapter4resultsfilterOXPHOS$SEX == "M"]) * 1.2


#plot of OXPHOS
ggplot(data=chapter4resultsfilterOXPHOS, aes(x=interaction_SEX_TIME, y=OXPHOS)) +
  geom_bar(data = summary_statsOXPHOS,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsOXPHOS,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterOXPHOS,
            aes(x = interaction_SEX_TIME, y = OXPHOS, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y = bquote("Total OXPHOS protein content (A.U.)")) +
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("Total OXPHOS protein content") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 15), breaks = seq(0, 15, by = 3)) +
    geom_signif(
              y_position = y_positionFcomparisonOXPHOS, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelOXPHOS,
              tip_length = 0, family = "sans", size=1, textsize=8) +
   geom_signif(
              y_position = y_positionMcomparisonOXPHOS, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelOXPHOS,
              tip_length = 0, family = "sans", size=1, textsize=8)
```

#MitoVD for cM, sM, and SS (Fig 4.4F)
```{r}
chapter4resultsfiltercM <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(cM)) | 
         !(any(TIME == "POST") & any(is.na(cM))))

#make each set of data plotted in the right spot
chapter4resultsfiltercM$TIME <- factor(chapter4resultsfiltercM$TIME, levels = c("PRE", "POST"))
chapter4resultsfiltercM$interaction_SEX_TIME <- interaction(chapter4resultsfiltercM$SEX, chapter4resultsfiltercM$TIME, drop = TRUE, lex.order = TRUE)

#get summary statisticM for bars on graph
summary_statscM <- chapter4resultsfiltercM %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(cM),
            sd_value = sd(cM, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultcM <- aov(cM ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfiltercM)
anovacM <- summary(anova_resultcM)
anovacM <- as.data.frame(anovacM$`Error: ID:TIME`[[1]])
twowaypvaluecM <- anovacM["SEX:TIME", "Pr(>F)"]
print(twowaypvaluecM)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonscM <- emmeans(anova_resultcM, ~ TIME | SEX)
multiplecomparisonscM <- summary(pairs(multiplecomparisonscM), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonscM$p.value[multiplecomparisonscM$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonscM$p.value[multiplecomparisonscM$SEX == "M"]


# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelcM <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelcM <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelcM <- ifelse(twowaypvaluecM <= 0.05, 
                             ifelse(twowaypvaluecM <= 0.001, "***", 
                                    ifelse(twowaypvaluecM <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitscM <- max(chapter4resultsfiltercM$cM) * 1.5

y_positionFcomparisoncM <- max(chapter4resultsfiltercM$cM[chapter4resultsfiltercM$SEX == "F"]) * 1.2

y_positionMcomparisoncM <- max(chapter4resultsfiltercM$cM[chapter4resultsfiltercM$SEX == "M"]) * 1.2

y_positionanovacM <- max(chapter4resultsfiltercM$cM) * 1.5

cMtitle <- expression("<span style='color:#fa7070'> Central</span> Mito<sub>VD</sub>")
sMtitle <- expression("<span style='color:#edd068'> Superficial</span> Mito<sub>VD</sub>")

#plot of cM
ggplot(data=chapter4resultsfiltercM, aes(x=interaction_SEX_TIME, y=cM)) +
  geom_bar(data = summary_statscM,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statscM,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfiltercM,
            aes(x = interaction_SEX_TIME, y = cM, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Central IFM Mito"[VD], (µm^3 ~"•"~ µm^-3 * ~ "myofibrillar space ")))) +   
       scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(cMtitle) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 0.2),breaks = seq(0, 0.2, by = 0.04)) +
  geom_signif(
              y_position = y_positionFcomparisoncM, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelcM,
              tip_length = 0, family = "sans", size=1, textsize=8) +
  geom_signif(
              y_position = y_positionMcomparisoncM, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelcM,
              tip_length = 0, family = "sans", size=1, textsize=8) +
  theme(plot.title = element_markdown())

chapter4resultsfiltersM <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(sM)) | 
         !(any(TIME == "POST") & any(is.na(sM))))

#make each set of data plotted in the right spot
chapter4resultsfiltersM$TIME <- factor(chapter4resultsfiltersM$TIME, levels = c("PRE", "POST"))
chapter4resultsfiltersM$interaction_SEX_TIME <- interaction(chapter4resultsfiltersM$SEX, chapter4resultsfiltersM$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistisM for bars on graph
summary_statssM <- chapter4resultsfiltersM %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(sM),
            sd_value = sd(sM, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultsM <- aov(sM ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfiltersM)
anovasM <- summary(anova_resultsM)
anovasM <- as.data.frame(anovasM$`Error: ID:TIME`[[1]])
twowaypvaluesM <- anovasM["SEX:TIME", "Pr(>F)"]
print(twowaypvaluesM)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonssM <- emmeans(anova_resultsM, ~ TIME | SEX)
multiplecomparisonssM <- summary(pairs(multiplecomparisonssM), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonssM$p.value[multiplecomparisonssM$SEX == "F"]


Mmultiplecomparisons <- multiplecomparisonssM$p.value[multiplecomparisonssM$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelsM <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelsM <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelsM <- ifelse(twowaypvaluesM <= 0.05, 
                             ifelse(twowaypvaluesM <= 0.001, "***", 
                                    ifelse(twowaypvaluesM <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitssM <- max(chapter4resultsfiltersM$sM) * 1.5

y_positionFcomparisonsM <- max(chapter4resultsfiltersM$sM[chapter4resultsfiltersM$SEX == "F"]) * 1.2

y_positionMcomparisonsM <- max(chapter4resultsfiltersM$sM[chapter4resultsfiltersM$SEX == "M"]) * 1.2

y_positionanovasM <- max(chapter4resultsfiltersM$sM) * 1.5

#plot of sM
ggplot(data=chapter4resultsfiltersM, aes(x=interaction_SEX_TIME, y=sM)) +
  geom_bar(data = summary_statssM,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statssM,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfiltersM,
            aes(x = interaction_SEX_TIME, y = sM, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Superficial IFM Mito"[VD], (µm^3 ~"•"~ µm^-3 * ~ "myofibrillar space ")))) +   
       scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(sMtitle) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 0.2),breaks = seq(0, 0.2, by = 0.04)) +
  geom_signif(
              y_position = y_positionFcomparisonsM, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelsM, tip_length = 0, family = "sans", size=1, textsize=8) +
  geom_signif(
              y_position = y_positionMcomparisonsM, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelsM, tip_length = 0, family = "sans", size=1, textsize=8) + 
  theme(plot.title = element_markdown())

chapter4resultsfilterSS <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(SS)) | 
         !(any(TIME == "POST") & any(is.na(SS))))

#make each set of data plotted in the right spot
chapter4resultsfilterSS$TIME <- factor(chapter4resultsfilterSS$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterSS$interaction_SEX_TIME <- interaction(chapter4resultsfilterSS$SEX, chapter4resultsfilterSS$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiSS for bars on graph
summary_statsSS <- chapter4resultsfilterSS %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(SS),
            sd_value = sd(SS, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultSS <- aov(SS ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterSS)
summary(anova_resultSS)
anovaSS <- summary(anova_resultSS)
anovaSS <- as.data.frame(anovaSS$`Error: ID:TIME`[[1]])
twowaypvalueSS <- anovaSS["SEX:TIME", "Pr(>F)"]
print(twowaypvalueSS)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsSS <- emmeans(anova_resultSS, ~ TIME | SEX)
multiplecomparisonsSS <- summary(pairs(multiplecomparisonsSS), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsSS$p.value[multiplecomparisonsSS$SEX == "F"]
Fmultiplecomparisons

Mmultiplecomparisons <- multiplecomparisonsSS$p.value[multiplecomparisonsSS$SEX == "M"]
Mmultiplecomparisons
# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelSS <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelSS <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelSS <- ifelse(twowaypvalueSS <= 0.05, 
                             ifelse(twowaypvalueSS <= 0.001, "***", 
                                    ifelse(twowaypvalueSS <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsSS <- max(chapter4resultsfilterSS$SS) * 1.5

y_positionFcomparisonSS <- max(chapter4resultsfilterSS$SS[chapter4resultsfilterSS$SEX == "F"]) * 1.2

y_positionMcomparisonSS <- max(chapter4resultsfilterSS$SS[chapter4resultsfilterSS$SEX == "M"]) * 1.2

y_positionanovaSS <- max(chapter4resultsfilterSS$SS) * 1.5

#plot of SS
ggplot(data=chapter4resultsfilterSS, aes(x=interaction_SEX_TIME, y=SS)) +
  geom_bar(data = summary_statsSS,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsSS,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterSS,
            aes(x = interaction_SEX_TIME, y = SS, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Subsarcolemmal mitochondrial content", (µm^3 ~"•"~ µm^-2 * ~ "fibre surface area")))) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("<span style='color:#8bde64'> Subsarcolemmal</span> content") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 0.4), breaks = seq(0, 0.4, by = 0.1)) +
  geom_signif(
              y_position = y_positionFcomparisonSS, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelSS, tip_length = 0, family = "sans", size=1, textsize=8) +
  geom_signif(
              y_position = y_positionMcomparisonSS, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelSS, tip_length = 0, family = "sans", size=1, textsize=8) + 
  theme(plot.title = element_markdown())
```

#TOTAL MitoVD (Fig 4.4G)
```{r}
chapter4resultsfilterTOTAL <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(TOTAL)) | 
         !(any(TIME == "POST") & any(is.na(TOTAL))))

#make each set of data plotted in the right spot
chapter4resultsfilterTOTAL$TIME <- factor(chapter4resultsfilterTOTAL$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterTOTAL$interaction_SEX_TIME <- interaction(chapter4resultsfilterTOTAL$SEX, chapter4resultsfilterTOTAL$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiTOTAL for bars on graph
summary_statsTOTAL <- chapter4resultsfilterTOTAL %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(TOTAL),
            sd_value = sd(TOTAL, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultTOTAL <- aov(TOTAL ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterTOTAL)
summary(anova_resultTOTAL)
anovaTOTAL <- summary(anova_resultTOTAL)
anovaTOTAL <- as.data.frame(anovaTOTAL$`Error: ID:TIME`[[1]])
twowaypvalueTOTAL <- anovaTOTAL["SEX:TIME", "Pr(>F)"]
print(twowaypvalueTOTAL)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsTOTAL <- emmeans(anova_resultTOTAL, ~ TIME | SEX)
multiplecomparisonsTOTAL <- summary(pairs(multiplecomparisonsTOTAL), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsTOTAL$p.value[multiplecomparisonsTOTAL$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsTOTAL$p.value[multiplecomparisonsTOTAL$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelTOTAL <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelTOTAL <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelTOTAL <- ifelse(twowaypvalueTOTAL <= 0.05, 
                             ifelse(twowaypvalueTOTAL <= 0.001, "***", 
                                    ifelse(twowaypvalueTOTAL <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsTOTAL <- max(chapter4resultsfilterTOTAL$TOTAL) * 1.5

y_positionFcomparisonTOTAL <- max(chapter4resultsfilterTOTAL$TOTAL[chapter4resultsfilterTOTAL$SEX == "F"]) * 1.2

y_positionMcomparisonTOTAL <- max(chapter4resultsfilterTOTAL$TOTAL[chapter4resultsfilterTOTAL$SEX == "M"]) * 1.2

y_positionanovaTOTAL <- max(chapter4resultsfilterTOTAL$TOTAL) * 1.5

TOTALmito <- expression(paste("Total fibre Mito"[VD]))

#plot of TOTAL
ggplot(data=chapter4resultsfilterTOTAL, aes(x=interaction_SEX_TIME, y=TOTAL)) +
  geom_bar(data = summary_statsTOTAL,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsTOTAL,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterTOTAL,
            aes(x = interaction_SEX_TIME, y = TOTAL, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression("Total fibre" ~~ "Mito"[VD]~(µm^3 ~"•"~ µm^-3 * ~ "fibre"))) +
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(TOTALmito) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 0.2),
                     breaks = seq(0, 0.2, by = 0.04)) +
    geom_signif(
              y_position = y_positionFcomparisonTOTAL, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelTOTAL,
              tip_length = 0, family = "sans", size=1, textsize=8) +
   geom_signif(
              y_position = y_positionMcomparisonTOTAL, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelTOTAL,
              tip_length = 0, family = "sans", size=1, textsize=8)
```

#Appendix IV (Fig 7.4.2)
```{r}
data_pre <- chapter4resultsfilterOXPHOS %>% dplyr::filter(TIME == "PRE")
data_post <- chapter4resultsfilterOXPHOS %>% dplyr::filter(TIME == "POST")

ggplot(chapter4resultsfilterOXPHOS, aes(x = TOTAL, y = OXPHOS)) + 
  labs(
    y = expression("OXPHOS protein content (A.U.)"), 
    x = expression("Total fibre" ~ "Mito"[VD] ~ (µm^3 * "•" * µm^-3 ~ "fibre")), 
    fill = "Sex", shape = "Time", color = "Time") +
  geom_point(aes(fill = SEX, shape = TIME), size = 6, colour = "black") + 
  scale_shape_manual(values = c("PRE" = 21, "POST" = 24)) + 
  scale_fill_manual(values = c("M" = "#94e2eb", "F" = "#e3b3e0"), labels = c("F" = "Women", "M" = "Men")) +
  scale_color_manual(
    values = c("Both time points" = "black", "PRE" = "green", "POST" = "red"), 
    labels = c("Both time points" = "Both time points", "PRE" = "PRE", "POST" = "POST"),
    breaks = c("Both time points", "PRE", "POST")) +
  stat_cor(data = data_pre, label.y = 1, label.x = 0.06, r.digits = 2,
           p.accuracy = 0.001, size = 6, colour = "green") + 
  stat_cor(data = data_post, label.y = 2, label.x = 0.06, r.digits = 2,
           p.accuracy = 0.001, size = 6, colour = "red") +
  stat_cor(data = chapter4resultsfilterOXPHOS, label.y = 3, label.x = 0.06,
           r.digits = 2, p.accuracy = 0.001, size = 6, colour = "black") +
  geom_smooth(data = data_pre, aes(color = "PRE"), method = "lm", se = TRUE, fill = "lightgrey", size = 2) +
  geom_smooth(data = data_post, aes(color = "POST"), method = "lm", se = TRUE, fill = "lightgrey", size = 2) +
  geom_smooth(aes(color = "Both time points"), method = "lm", se = TRUE, fill = "lightgrey", size = 2) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits = c(0, 12), breaks = seq(2, 12, by = 2)) +  
  scale_x_continuous(expand = expansion(mult = c(0, 0)), limits = c(0, 0.15), breaks = seq(0, 0.15, by = 0.03)) +
  ggtitle(expression("Correlation between Mito"[VD] ~ "and OXPHOS protein content")) +
  theme_classic() +
  theme(
    axis.text.x = element_text(size = 12),
    axis.text.y = element_text(size = 12),
    axis.title.x = element_text(size = 12), 
    axis.title.y = element_text(size = 12),
    plot.title = element_text(size = 16)) +
  guides(
    fill = guide_legend(title = "Sex", override.aes = list(colour = NA, shape = c(22, 22),
                                                           fill = c("#e3b3e0", "#94e2eb"))),
    shape = guide_legend(title = "Time", override.aes = list(fill = c("white", "white"))),
    color = guide_legend(title = "Correlation", override.aes=list(fill =c("white"))))

data_pre <- chapter4resultsfilterCSACTIVE %>% filter(TIME == "PRE")
data_post <- chapter4resultsfilterCSACTIVE %>% filter(TIME == "POST")

ggplot(chapter4resultsfilterTOTAL, aes(x = TOTAL, y = CSACTIVE)) + 
  labs(
    y = expression("CS activity " * (mol * "•" * h^-1 * "•" * "kg protein"^-1)), 
    x = expression("Total fibre" ~ "Mito"[VD] ~ (µm^3 * "•" * µm^-3 ~ "fibre")), 
    fill = "Sex", shape = "Time", color = "Time") +
  geom_point(aes(fill = SEX, shape = TIME), size = 6, colour = "black") + 
  scale_shape_manual(values = c("PRE" = 21, "POST" = 24)) + 
  scale_fill_manual(values = c("M" = "#94e2eb", "F" = "#e3b3e0"), labels = c("F" = "Women", "M" = "Men")) +
  scale_color_manual(
    values = c("Both time points" = "black", "PRE" = "green", "POST" = "red"), 
    labels = c("Both time points" = "Both time points", "PRE" = "PRE", "POST" = "POST"),
    breaks = c("Both time points", "PRE", "POST")) +
  stat_cor(data = data_pre, label.y = 1, label.x = 0.06, r.digits = 2,
           p.accuracy = 0.001, size = 6, colour = "green") + 
  stat_cor(data = data_post, label.y = 2, label.x = 0.06, r.digits = 2,
           p.accuracy = 0.001, size = 6, colour = "red") +
  stat_cor(data = chapter4resultsfilterTOTAL, label.y = 3, label.x = 0.06,
           r.digits = 2, p.accuracy = 0.001, size = 6, colour = "black") +
  geom_smooth(data = data_pre, aes(color = "PRE"), method = "lm", se = TRUE, fill = "lightgrey", size = 2) +
  geom_smooth(data = data_post, aes(color = "POST"), method = "lm", se = TRUE, fill = "lightgrey", size = 2) +
  geom_smooth(aes(color = "Both time points"), method = "lm", se = TRUE, fill = "lightgrey", size = 2) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits = c(0, 12), breaks = seq(2, 12, by = 2)) +  
  scale_x_continuous(expand = expansion(mult = c(0, 0)), limits = c(0, 0.15), breaks = seq(0, 0.15, by = 0.03)) +
  ggtitle(expression("Correlation between Mito"[VD] ~ "and CS activity")) +
  theme_classic() +
  theme(
    axis.text.x = element_text(size = 12),
    axis.text.y = element_text(size = 12),
    axis.title.x = element_text(size = 12), 
    axis.title.y = element_text(size = 12),
    plot.title = element_text(size = 16)) +
  guides(
    fill = guide_legend(title = "Sex", override.aes = list(colour = NA, shape = c(22, 22),
                                                           fill = c("#e3b3e0", "#94e2eb"))),
    shape = guide_legend(title = "Time", override.aes = list(fill = c("white", "white"))),
    color = guide_legend(title = "Correlation", override.aes=list(fill =c("white"))))
```

#Change in CS/OXPHOS vs. total mitoVD (Fig 4.4H & 4.4I)
```{r}
chapter4resultsfilter <- chapter4results %>% 
  dplyr::filter(!is.na(TOTAL))

chapter4resultsfilter <- chapter4resultsfilter %>% 
  dplyr::filter(!is.na(CI) & !is.na(CII) & !is.na(CIII) & !is.na(CIV) & !is.na(CV))

chapter4resultsfilter <-  chapter4resultsfilter %>% group_by(ID, TIME) %>%
  mutate(OXPHOS = CI + CII + CIII + CIV + CV)

TEMcorrelation <- chapter4resultsfilter %>%
  group_by(ID) %>%
  mutate(CScor = (((CSACTIVE[TIME == "POST"] / CSACTIVE[TIME == "PRE"]) - 1) * 100)) %>%
  mutate(OXPHOScor = (((OXPHOS[TIME == "POST"] / OXPHOS[TIME == "PRE"]) - 1) * 100)) %>%
  mutate(TOTALcor = (((TOTAL[TIME == "POST"] / TOTAL[TIME == "PRE"]) - 1) * 100))

TEMcorrelation <- TEMcorrelation %>%
    dplyr::filter(TIME == "PRE")

TEMcorrelation$SEX <- factor(TEMcorrelation$SEX, levels = c("F", "M"))

CSmitovdtitle <- expression(atop("Changes in total mito"[VD]~"relative to CS activity"))

ggplot(TEMcorrelation, aes(x = TOTALcor, y = CScor)) + 
  labs(y = expression("Change in CS activity (%)"), 
       x = expression("Change in total mito"[VD]~"(%)"), 
       fill = "Sex")  + 
  geom_hline(yintercept = 0, linetype = "dashed", colour = "black") +
  geom_smooth(data = TEMcorrelation %>% dplyr::filter(SEX == "M"),
             aes(colour = "M"), method = "lm", se=FALSE, size = 2, show.legend = FALSE) +
  geom_smooth(data = TEMcorrelation %>% dplyr::filter(SEX == "F"),
             aes(colour = "F"), method = "lm", se=FALSE, size = 2, show.legend = FALSE) +
  geom_smooth(data = TEMcorrelation,
             aes(colour = "Both sexes together"), method = "lm", se=FALSE, size = 2, show.legend = FALSE) +
  geom_point(data = TEMcorrelation,
             aes(fill = SEX), shape = 21, size = 6, show.legend = FALSE) +
  scale_fill_manual(values = c("M" = "#94e2eb", "F" = "#e3b3e0"), 
                    labels = c("F" = "Women", "M" = "Men")) +
  scale_colour_manual(values=c("M" = "#94e2eb", "F" = "#e3b3e0", "Both sexes together" = "grey"),
                      labels = c("F" = "Women", "M" = "Men", "Both sexes together" = "Men & Women")) +
  stat_cor(data = (TEMcorrelation %>% dplyr::filter(SEX == "F")),
    color = "#e3b3e0", label.x = 140, label.y = 95, size = 6, p.accuracy = 0.001) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(SEX == "M"),
    color = "#94e2eb", label.x = 140, label.y = 85, size = 6,  p.accuracy = 0.001) +
  stat_cor(data = TEMcorrelation,
    colour = "grey", label.x = 140, label.y = 75, size = 6,  p.accuracy = 0.001) +
  ggtitle(CSmitovdtitle) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12),
        axis.title.x = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 14),
        plot.margin = ggplot2::margin(0, 1, 0, 0, "cm")) +
  guides(fill = guide_legend(title = "Sex", override.aes = list(colour = "black",
                shape = c(21, 21),
                fill = c("#e3b3e0", "#94e2eb"))),
                color = guide_legend(title = "Correlation", override.aes=list(fill =c("white")))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)),limits= c(-20, 100), breaks = seq(-20, 100, by = 20)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0)),limits= c(0, 300), breaks = seq(0, 300, by = 50))

OXPHOSmitovdtitle <- expression(atop("Changes in total mito"[VD]~"relative to OXPHOS protein content"))

ggplot(TEMcorrelation, aes(x = TOTALcor, y = OXPHOScor)) + 
  labs(y = expression("Change in OXPHOS protein content (%)"), 
       x = expression("Change in total mito"[VD]~"(%)"), 
       fill = "Sex")  + 
  geom_smooth(data = TEMcorrelation %>% dplyr::filter(SEX == "M"),
             aes(colour = "M"), method = "lm", se=FALSE, size = 2, show.legend = FALSE) +
  geom_smooth(data = TEMcorrelation %>% dplyr::filter(SEX == "F"),
             aes(colour = "F"), method = "lm", se=FALSE, size = 2, show.legend = FALSE) +
  geom_smooth(data = TEMcorrelation,
             aes(colour = "Both sexes together"), method = "lm", se=FALSE, size = 2, show.legend = FALSE) +
  geom_point(data = TEMcorrelation,
             aes(fill = SEX), shape = 21, size = 6, show.legend = FALSE) +
  scale_fill_manual(values = c("M" = "#94e2eb", "F" = "#e3b3e0"), 
                    labels = c("F" = "Women", "M" = "Men")) +
  scale_colour_manual(values=c("M" = "#94e2eb", "F" = "#e3b3e0", "Both sexes together" = "grey"),
                      labels = c("F" = "Women", "M" = "Men", "Both sexes together" = "Men & Women")) +
  stat_cor(data = (TEMcorrelation %>% dplyr::filter(SEX == "F")),
   color = "#e3b3e0", label.x = 150, label.y = 145, size = 6, p.accuracy = 0.001) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(SEX == "M"), 
    color = "#94e2eb", label.x = 150, label.y = 132, size = 6,  p.accuracy = 0.001) +
  stat_cor(data = TEMcorrelation,
    colour = "grey", label.x = 150, label.y = 119, size = 6,  p.accuracy = 0.001) +
  ggtitle(OXPHOSmitovdtitle) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12),
        axis.title.x = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 14),
        plot.margin = ggplot2::margin(0, 1, 0, 0, "cm")) +
  guides(fill = guide_legend(title = "Sex", override.aes = list(colour = "black",
                shape = c(21, 21),
                fill = c("#e3b3e0", "#94e2eb"))),
                color = guide_legend(title = "Correlation", override.aes=list(fill =c("white")))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)),limits= c(0, 150), breaks = seq(30, 150, by = 30)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0)),limits= c(0, 300), breaks = seq(0, 300, by = 50))
```

#Mass-specific respiration (Fig 4.5B)
```{r}
chapter4resultsfilterCIL <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(CIL)) | 
         !(any(TIME == "POST") & any(is.na(CIL))))

#make each set of data plotted in the right spot
chapter4resultsfilterCIL$TIME <- factor(chapter4resultsfilterCIL$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIL$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIL$SEX, chapter4resultsfilterCIL$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistics for bars on graph
summary_statsCIL <- chapter4resultsfilterCIL %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIL),
            sd_value = sd(CIL, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIL <- aov(CIL ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIL)
anovaCIL <- summary(anova_resultCIL)
anovaCIL <- as.data.frame(anovaCIL$`Error: ID:TIME`[[1]])
twowaypvalueCIL <- anovaCIL["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIL)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIL <- emmeans(anova_resultCIL, ~ TIME | SEX)
multiplecomparisonsCIL <- summary(pairs(multiplecomparisonsCIL), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIL$p.value[multiplecomparisonsCIL$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCIL$p.value[multiplecomparisonsCIL$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIL <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCIL <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCIL <- ifelse(twowaypvalueCIL <= 0.05, 
                             ifelse(twowaypvalueCIL <= 0.001, "***", 
                                    ifelse(twowaypvalueCIL <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIL <- max(chapter4resultsfilterCIL$CIL) * 1.5

y_positionFcomparisonCIL <- max(chapter4resultsfilterCIL$CIL[chapter4resultsfilterCIL$SEX == "F"]) * 1.2

y_positionMcomparisonCIL <- max(chapter4resultsfilterCIL$CIL[chapter4resultsfilterCIL$SEX == "M"]) * 1.2

y_positionanovaCIL <- max(chapter4resultsfilterCIL$CIL) * 1.5

CILeak <- bquote(paste("Leak respiration (CI"[L],")"))

#plot of CIL
ggplot(data=chapter4resultsfilterCIL, aes(x=interaction_SEX_TIME, y=CIL)) +
  geom_bar(data = summary_statsCIL,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCIL,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIL,
            aes(x = interaction_SEX_TIME, y = CIL, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Mass-specific mitochondrial respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1)))) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CILeak) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 250),breaks = seq(0, 250, by = 25))

chapter4resultsfilterCIP <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(CIP)) | 
         !(any(TIME == "POST") & any(is.na(CIP))))

#make each set of data plotted in the right spot
chapter4resultsfilterCIP$TIME <- factor(chapter4resultsfilterCIP$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIP$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIP$SEX, chapter4resultsfilterCIP$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistics for bars on graph
summary_statsCIP <- chapter4resultsfilterCIP %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIP),
            sd_value = sd(CIP, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIP <- aov(CIP ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIP)
anovaCIP <- summary(anova_resultCIP)
anovaCIP <- as.data.frame(anovaCIP$`Error: ID:TIME`[[1]])
twowaypvalueCIP <- anovaCIP["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIP)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIP <- emmeans(anova_resultCIP, ~ TIME | SEX)
multiplecomparisonsCIP <- summary(pairs(multiplecomparisonsCIP), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIP$p.value[multiplecomparisonsCIP$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCIP$p.value[multiplecomparisonsCIP$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIP <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCIP <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCIP <- ifelse(twowaypvalueCIP <= 0.05, 
                             ifelse(twowaypvalueCIP <= 0.001, "***", 
                                    ifelse(twowaypvalueCIP <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIP <- max(chapter4resultsfilterCIP$CIP) * 1.5

y_positionFcomparisonCIP <- max(chapter4resultsfilterCIP$CIP[chapter4resultsfilterCIP$SEX == "F"]) * 1.2

y_positionMcomparisonCIP <- max(chapter4resultsfilterCIP$CIP[chapter4resultsfilterCIP$SEX == "M"]) * 1.2

y_positionanovaCIP <- max(chapter4resultsfilterCIP$CIP) * 1.5

CIPeak <- bquote(paste("Complex I peak (CI"[P],")"))

#plot of CIP
ggplot(data=chapter4resultsfilterCIP, aes(x=interaction_SEX_TIME, y=CIP)) +
  geom_bar(data = summary_statsCIP,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCIP,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIP,
            aes(x = interaction_SEX_TIME, y = CIP, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Mass-specific mitochondrial respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1)))) +  
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIPeak) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 250),breaks = seq(0, 250, by = 25))

chapter4resultsfilterCIIIP <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(CIIIP)) | 
         !(any(TIME == "POST") & any(is.na(CIIIP))))

#make each set of data plotted in the right spot
chapter4resultsfilterCIIIP$TIME <- factor(chapter4resultsfilterCIIIP$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIIIP$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIIIP$SEX, chapter4resultsfilterCIIIP$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistics for bars on graph
summary_statsCIIIP <- chapter4resultsfilterCIIIP %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIIIP),
            sd_value = sd(CIIIP, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIIIP <- aov(CIIIP ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIIIP)
anovaCIIIP <- summary(anova_resultCIIIP)
anovaCIIIP <- as.data.frame(anovaCIIIP$`Error: ID:TIME`[[1]])
twowaypvalueCIIIP <- anovaCIIIP["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIIIP)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIIIP <- emmeans(anova_resultCIIIP, ~ TIME | SEX)
multiplecomparisonsCIIIP <- summary(pairs(multiplecomparisonsCIIIP), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIIIP$p.value[multiplecomparisonsCIIIP$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCIIIP$p.value[multiplecomparisonsCIIIP$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIIIP <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCIIIP <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCIIIP <- ifelse(twowaypvalueCIIIP <= 0.05, 
                             ifelse(twowaypvalueCIIIP <= 0.001, "***", 
                                    ifelse(twowaypvalueCIIIP <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIIIP <- max(chapter4resultsfilterCIIIP$CIIIP) * 1.5

y_positionFcomparisonCIIIP <- max(chapter4resultsfilterCIIIP$CIIIP[chapter4resultsfilterCIIIP$SEX == "F"]) * 1.2

y_positionMcomparisonCIIIP <- max(chapter4resultsfilterCIIIP$CIIIP[chapter4resultsfilterCIIIP$SEX == "M"]) * 1.2

y_positionanovaCIIIP <- max(chapter4resultsfilterCIIIP$CIIIP) * 1.5

CIIIPeak <- bquote(paste("Complex I+II peak (CI+II"[P],")"))
#plot of CIIIP
ggplot(data=chapter4resultsfilterCIIIP, aes(x=interaction_SEX_TIME, y=CIIIP)) +
  geom_bar(data = summary_statsCIIIP,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCIIIP,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIIIP,
            aes(x = interaction_SEX_TIME, y = CIIIP, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Mass-specific mitochondrial respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1))))  +
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIIIPeak) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 250),breaks = seq(0, 250, by = 25)) +
  geom_signif(
              y_position = y_positionFcomparisonCIIIP, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelCIIIP,
              tip_length = 0, family = "sans", size=1, textsize=8) +
   geom_signif(
              y_position = y_positionMcomparisonCIIIP, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelCIIIP,
              tip_length = 0, family = "sans", size=1, textsize=8)

chapter4resultsfilterCIIIC <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(CIIIC)) | 
         !(any(TIME == "POST") & any(is.na(CIIIC))))

#make each set of data plotted in the right spot
chapter4resultsfilterCIIIC$TIME <- factor(chapter4resultsfilterCIIIC$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIIIC$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIIIC$SEX, chapter4resultsfilterCIIIC$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistics for bars on graph
summary_statsCIIIC <- chapter4resultsfilterCIIIC %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIIIC),
            sd_value = sd(CIIIC, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIIIC <- aov(CIIIC ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIIIC)
anovaCIIIC <- summary(anova_resultCIIIC)
anovaCIIIC <- as.data.frame(anovaCIIIC$`Error: ID:TIME`[[1]])
twowaypvalueCIIIC <- anovaCIIIC["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIIIC)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIIIC <- emmeans(anova_resultCIIIC, ~ TIME | SEX)
multiplecomparisonsCIIIC <- summary(pairs(multiplecomparisonsCIIIC), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIIIC$p.value[multiplecomparisonsCIIIC$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCIIIC$p.value[multiplecomparisonsCIIIC$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIIIC <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCIIIC <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCIIIC <- ifelse(twowaypvalueCIIIC <= 0.05, 
                             ifelse(twowaypvalueCIIIC <= 0.001, "***", 
                                    ifelse(twowaypvalueCIIIC <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIIIC <- max(chapter4resultsfilterCIIIC$CIIIC) * 1.5

y_positionFcomparisonCIIIC <- max(chapter4resultsfilterCIIIC$CIIIC[chapter4resultsfilterCIIIC$SEX == "F"]) * 1.2

y_positionMcomparisonCIIIC <- max(chapter4resultsfilterCIIIC$CIIIC[chapter4resultsfilterCIIIC$SEX == "M"]) * 1.2

y_positionanovaCIIIC <- max(chapter4resultsfilterCIIIC$CIIIC) * 1.5

CIIICeak <- bquote(paste("Complex I+II capacity (CI+II"[E],")"))
#plot of CIIIC
ggplot(data=chapter4resultsfilterCIIIC, aes(x=interaction_SEX_TIME, y=CIIIC)) +
  geom_bar(data = summary_statsCIIIC,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCIIIC,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIIIC,
            aes(x = interaction_SEX_TIME, y = CIIIC, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Mass-specific mitochondrial respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1)))) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIIICeak) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 250),breaks = seq(0, 250, by = 25)) +
  geom_signif(
              y_position = y_positionFcomparisonCIIIC, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelCIIIC,
              tip_length = 0, family = "sans", size=1, textsize=8) +
  geom_signif(
              y_position = y_positionMcomparisonCIIIC, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelCIIIC,
              tip_length = 0, family = "sans", size=1, textsize=8)
```

#ADP sensitivity group curves (Fig 4.5D)
```{r}
Kmrep <- openxlsx::read.xlsx("data/Kmrepresentative.xlsx")

KmrepPREmen <- Kmrep %>%
            dplyr::filter(time == "PRE") %>% dplyr::filter(sex == "men")
KmrepPOSTmen <- Kmrep %>%
            dplyr::filter(time == "POST") %>% dplyr::filter(sex == "men")

model.drm1 <- drm (percent ~ adp, data = KmrepPREmen, fct = MM.2())
model.drm2 <- drm (percent ~ adp, data = KmrepPOSTmen, fct = MM.2())

mml1 <- data.frame(S = seq(0, max(KmrepPREmen$adp), length.out = 100))
mml1$v <- predict(model.drm1, newdata = mml1)
mml2 <- data.frame(S = seq(0, max(KmrepPOSTmen$adp), length.out = 100))
mml2$v <- predict(model.drm2, newdata = mml2)

KmrepPREwomen <- Kmrep %>%
            dplyr::filter(time == "PRE") %>% dplyr::filter(sex == "women")
KmrepPOSTwomen <- Kmrep %>%
            dplyr::filter(time == "POST") %>% dplyr::filter(sex == "women")

model.drm3 <- drm (percent ~ adp, data = KmrepPREwomen, fct = MM.2())
model.drm4 <- drm (percent ~ adp, data = KmrepPOSTwomen, fct = MM.2())

mml3 <- data.frame(S = seq(0, max(KmrepPREwomen$adp), length.out = 100))
mml3$v <- predict(model.drm3, newdata = mml3)
mml4 <- data.frame(S = seq(0, max(KmrepPOSTwomen$adp), length.out = 100))
mml4$v <- predict(model.drm4, newdata = mml4)

Kmrep$interaction_SEX_TIME <- interaction(Kmrep$sex, Kmrep$time, drop = TRUE, lex.order = TRUE)
Kmrep$interaction_SEX_TIME <- factor(Kmrep$interaction_SEX_TIME, levels = c("men.PRE", "men.POST", "women.PRE", "women.POST"))

ggplot(Kmrep, aes(x = adp, y = percent, colour = interaction_SEX_TIME)) +
  geom_point(size = 3) +
  labs(y = "% of maximal respiration", x = "ADP concentration (μM)", colour = "Group") +
  ggtitle("Michaelis-Menten ADP kinetics") +
  scale_colour_manual(labels = c("men.PRE" = "PRE Men", "men.POST" = "POST Men",
                                 "women.PRE" = "PRE Women", "women.POST" = "POST Women"),
                      values = c("men.PRE" = "#94e2eb", "men.POST" = "#34d8eb",
                                 "women.PRE" = "#e3b3e0", "women.POST" = "#e887e3")) +
  geom_line(size = 1, data = mml1, aes(x = S, y = v), colour = "#94e2eb") + 
  geom_line(size = 1, data = mml2, aes(x = S, y = v), colour = "#34d8eb") +
  geom_line(size = 1, data = mml3, aes(x = S, y = v), colour = "#e3b3e0") + 
  geom_line(size = 1, data = mml4, aes(x = S, y = v), colour = "#e887e3") +
  geom_hline(yintercept = 50, linetype = "dashed", colour = "red") +
  geom_text(aes(x=6000, y=55), inherit.aes = FALSE, label="Michaelis-Menten constant (Km)",
            size = 6, colour="black") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 16,),
        axis.text.y = element_text(size = 16), 
        axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16),
        plot.title = element_text(size = 16, hjust=0.45)) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 120),breaks = seq(0, 120, by = 20))
```

#ADP sensitivity individual participants (Fig 4.5E)
```{r}
chapter4resultsfilterKM <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(KM)) | 
         !(any(TIME == "POST") & any(is.na(KM))))

#make each set of data plotted in the right spot
chapter4resultsfilterKM$TIME <- factor(chapter4resultsfilterKM$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterKM$interaction_SEX_TIME <- interaction(chapter4resultsfilterKM$SEX, chapter4resultsfilterKM$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistics for bars on graph
summary_statsKM <- chapter4resultsfilterKM %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(KM),
            sd_value = sd(KM, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultKM <- aov(KM ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterKM)
anovaKM <- summary(anova_resultKM)
anovaKM <- as.data.frame(anovaKM$`Error: ID:TIME`[[1]])
twowaypvalueKM <- anovaKM["SEX:TIME", "Pr(>F)"]
print(twowaypvalueKM)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsKM <- emmeans(anova_resultKM, ~ TIME | SEX)
multiplecomparisonsKM <- summary(pairs(multiplecomparisonsKM), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsKM$p.value[multiplecomparisonsKM$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsKM$p.value[multiplecomparisonsKM$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelKM <- round(Mmultiplecomparisons, 3)

Fcomparesignificance_levelKM <- round(Fmultiplecomparisons, 3)

anovasignificance_levelKM <- ifelse(twowaypvalueKM <= 0.05, 
                             ifelse(twowaypvalueKM <= 0.001, "***", 
                                    ifelse(twowaypvalueKM <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsKM <- max(chapter4resultsfilterKM$KM) * 1.5

y_positionFcomparisonKM <- max(chapter4resultsfilterKM$KM[chapter4resultsfilterKM$SEX == "F"]) * 1.2

y_positionMcomparisonKM <- max(chapter4resultsfilterKM$KM[chapter4resultsfilterKM$SEX == "M"]) * 1.2

y_positionanovaKM <- max(chapter4resultsfilterKM$KM) * 1.5

#plot of KM
ggplot(data=chapter4resultsfilterKM, aes(x=interaction_SEX_TIME, y=KM)) +
  geom_bar(data = summary_statsKM,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsKM,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterKM,
            aes(x = interaction_SEX_TIME, y = KM, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression("ADP sensitivity (µM of ADP)")) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("ADP sensitivity") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 3500),breaks = seq(0, 3500, by = 500)) +
  geom_signif(
              y_position = y_positionFcomparisonKM, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelKM,
              tip_length = 0, family = "sans", size=1, textsize=6) +
   geom_signif(
              y_position = y_positionMcomparisonKM, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelKM,
              tip_length = 0, family = "sans", size=1, textsize=6)
```

#Mitochondrial-specific respiration (normalisation by mitoVD - Fig 4.5F)
```{r}
chapter4results <-  chapter4results%>% group_by(ID, TIME) %>%
  mutate(OXPHOS = CI + CII + CIII + CIV + CV)

chapter4results <- chapter4results %>%
  group_by(ID, TIME) %>%
  mutate(CILCS = CIL / TOTAL,
         CIPCS = CIP / TOTAL,
         CIIIPCS = CIIIP / TOTAL,
         CIIICCS = CIIIC / TOTAL)

chapter4resultsfilterCILCS <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(CILCS)) | 
         !(any(TIME == "POST") & any(is.na(CILCS))))

#make each set of data plotted in the right spot
chapter4resultsfilterCILCS$TIME <- factor(chapter4resultsfilterCILCS$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCILCS$interaction_SEX_TIME <- interaction(chapter4resultsfilterCILCS$SEX, chapter4resultsfilterCILCS$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistics for bars on graph
summary_statsCILCS <- chapter4resultsfilterCILCS %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CILCS),
            sd_value = sd(CILCS, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCILCS <- aov(CILCS ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCILCS)
anovaCILCS <- summary(anova_resultCILCS)
summary(anova_resultCILCS)
anovaCILCS <- as.data.frame(anovaCILCS$`Error: ID:TIME`[[1]])
twowaypvalueCILCS <- anovaCILCS["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCILCS)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCILCS <- emmeans(anova_resultCILCS, ~ TIME | SEX)
multiplecomparisonsCILCS <- summary(pairs(multiplecomparisonsCILCS), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCILCS$p.value[multiplecomparisonsCILCS$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCILCS$p.value[multiplecomparisonsCILCS$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCILCS <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCILCS <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCILCS <- ifelse(twowaypvalueCILCS <= 0.05, 
                             ifelse(twowaypvalueCILCS <= 0.001, "***", 
                                    ifelse(twowaypvalueCILCS <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCILCS <- max(chapter4resultsfilterCILCS$CILCS) * 1.5

y_positionFcomparisonCILCS <- max(chapter4resultsfilterCILCS$CILCS[chapter4resultsfilterCILCS$SEX == "F"]) * 1.2

y_positionMcomparisonCILCS <- max(chapter4resultsfilterCILCS$CILCS[chapter4resultsfilterCILCS$SEX == "M"]) * 1.2

y_positionanovaCILCS <- max(chapter4resultsfilterCILCS$CILCS) * 1.5

CILCSeak <- bquote(paste("Leak respiration (CI"[L],")"))
#plot of CILCS
ggplot(data=chapter4resultsfilterCILCS, aes(x=interaction_SEX_TIME, y=CILCS)) +
  geom_bar(data = summary_statsCILCS,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCILCS,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCILCS,
            aes(x = interaction_SEX_TIME, y = CILCS, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Mitochondrial-specific respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1*"•total mito"[VD]^~~~~~-1)))) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CILCSeak) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 5000),breaks = seq(0, 5000, by = 1000))

chapter4resultsfilterCIPCS <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(CIPCS)) | 
         !(any(TIME == "POST") & any(is.na(CIPCS))))

#make each set of data plotted in the right spot
chapter4resultsfilterCIPCS$TIME <- factor(chapter4resultsfilterCIPCS$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIPCS$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIPCS$SEX, chapter4resultsfilterCIPCS$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistics for bars on graph
summary_statsCIPCS <- chapter4resultsfilterCIPCS %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIPCS),
            sd_value = sd(CIPCS, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIPCS <- aov(CIPCS ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIPCS)
anovaCIPCS <- summary(anova_resultCIPCS)
summary(anova_resultCIPCS)
anovaCIPCS <- as.data.frame(anovaCIPCS$`Error: ID:TIME`[[1]])
twowaypvalueCIPCS <- anovaCIPCS["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIPCS)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIPCS <- emmeans(anova_resultCIPCS, ~ TIME | SEX)
multiplecomparisonsCIPCS <- summary(pairs(multiplecomparisonsCIPCS), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIPCS$p.value[multiplecomparisonsCIPCS$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCIPCS$p.value[multiplecomparisonsCIPCS$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIPCS <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCIPCS <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCIPCS <- ifelse(twowaypvalueCIPCS <= 0.05, 
                             ifelse(twowaypvalueCIPCS <= 0.001, "***", 
                                    ifelse(twowaypvalueCIPCS <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIPCS <- max(chapter4resultsfilterCIPCS$CIPCS) * 1.5

y_positionFcomparisonCIPCS <- max(chapter4resultsfilterCIPCS$CIPCS[chapter4resultsfilterCIPCS$SEX == "F"]) * 1.2

y_positionMcomparisonCIPCS <- max(chapter4resultsfilterCIPCS$CIPCS[chapter4resultsfilterCIPCS$SEX == "M"]) * 1.2

y_positionanovaCIPCS <- max(chapter4resultsfilterCIPCS$CIPCS) * 1.5

CIPCSeak <- bquote(paste("Complex I peak (CI"[P],")"))
#plot of CIPCS
ggplot(data=chapter4resultsfilterCIPCS, aes(x=interaction_SEX_TIME, y=CIPCS)) +
  geom_bar(data = summary_statsCIPCS,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCIPCS,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIPCS,
            aes(x = interaction_SEX_TIME, y = CIPCS, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Mitochondrial-specific respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1*"•total mito"[VD]^~~~~~-1)))) +  
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIPCSeak) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 5000), breaks = seq(0, 5000, by = 1000)) +
  geom_signif(
              y_position = y_positionFcomparisonCIPCS, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelCIPCS,
              tip_length = 0, family = "sans", size=1, textsize=8) +
   geom_signif(
              y_position = y_positionMcomparisonCIPCS, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelCIPCS,
              tip_length = 0, family = "sans", size=1, textsize=8)

chapter4resultsfilterCIIIPCS <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(CIIIPCS)) | 
         !(any(TIME == "POST") & any(is.na(CIIIPCS))))

#make each set of data plotted in the right spot
chapter4resultsfilterCIIIPCS$TIME <- factor(chapter4resultsfilterCIIIPCS$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIIIPCS$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIIIPCS$SEX, chapter4resultsfilterCIIIPCS$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistics for bars on graph
summary_statsCIIIPCS <- chapter4resultsfilterCIIIPCS %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIIIPCS),
            sd_value = sd(CIIIPCS, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIIIPCS <- aov(CIIIPCS ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIIIPCS)
anovaCIIIPCS <- summary(anova_resultCIIIPCS)
summary(anova_resultCIIIPCS)
anovaCIIIPCS <- as.data.frame(anovaCIIIPCS$`Error: ID:TIME`[[1]])
twowaypvalueCIIIPCS <- anovaCIIIPCS["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIIIPCS)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIIIPCS <- emmeans(anova_resultCIIIPCS, ~ TIME | SEX)
multiplecomparisonsCIIIPCS <- summary(pairs(multiplecomparisonsCIIIPCS), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIIIPCS$p.value[multiplecomparisonsCIIIPCS$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCIIIPCS$p.value[multiplecomparisonsCIIIPCS$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIIIPCS <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCIIIPCS <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCIIIPCS <- ifelse(twowaypvalueCIIIPCS <= 0.05, 
                             ifelse(twowaypvalueCIIIPCS <= 0.001, "***", 
                                    ifelse(twowaypvalueCIIIPCS <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIIIPCS <- max(chapter4resultsfilterCIIIPCS$CIIIPCS) * 1.5

y_positionFcomparisonCIIIPCS <- max(chapter4resultsfilterCIIIPCS$CIIIPCS[chapter4resultsfilterCIIIPCS$SEX == "F"]) * 1.2

y_positionMcomparisonCIIIPCS <- max(chapter4resultsfilterCIIIPCS$CIIIPCS[chapter4resultsfilterCIIIPCS$SEX == "M"]) * 1.2

y_positionanovaCIIIPCS <- max(chapter4resultsfilterCIIIPCS$CIIIPCS) * 1.5

CIIIPCSeak <- bquote(paste("Complex I+II peak (CI+II"[P],")"))
#plot of CIIIPCS
ggplot(data=chapter4resultsfilterCIIIPCS, aes(x=interaction_SEX_TIME, y=CIIIPCS)) +
  geom_bar(data = summary_statsCIIIPCS,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCIIIPCS,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIIIPCS,
            aes(x = interaction_SEX_TIME, y = CIIIPCS, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Mitochondrial-specific respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1*"•total mito"[VD]^~~~~~-1))))  +
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIIIPCSeak) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 5000),breaks = seq(0, 5000, by = 1000)) +
  geom_signif(
              y_position = y_positionFcomparisonCIIIPCS, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelCIIIPCS,
              tip_length = 0, family = "sans", size=1, textsize=8) +
  geom_signif(
              y_position = y_positionMcomparisonCIIIPCS, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelCIIIPCS,
              tip_length = 0, family = "sans", size=1, textsize=8)

chapter4resultsfilterCIIICCS <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(CIIICCS)) | 
         !(any(TIME == "POST") & any(is.na(CIIICCS))))

#make each set of data plotted in the right spot
chapter4resultsfilterCIIICCS$TIME <- factor(chapter4resultsfilterCIIICCS$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIIICCS$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIIICCS$SEX, chapter4resultsfilterCIIICCS$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiCIIICCS for bars on graph
summary_statsCIIICCS <- chapter4resultsfilterCIIICCS %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIIICCS),
            sd_value = sd(CIIICCS, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIIICCS <- aov(CIIICCS ~ TIME * SEX + Error(ID/TIME), data = chapter4resultsfilterCIIICCS)
anovaCIIICCS <- summary(anova_resultCIIICCS)
summary(anova_resultCIIICCS)
anovaCIIICCS <- as.data.frame(anovaCIIICCS$`Error: ID:TIME`[[1]])
twowaypvalueCIIICCS <- anovaCIIICCS["TIME:SEX", "Pr(>F)"]
print(twowaypvalueCIIICCS)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIIICCS <- emmeans(anova_resultCIIICCS, ~ TIME | SEX)
multiplecomparisonsCIIICCS <- summary(pairs(multiplecomparisonsCIIICCS), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIIICCS$p.value[multiplecomparisonsCIIICCS$SEX == "F"]
Fmultiplecomparisons
Mmultiplecomparisons <- multiplecomparisonsCIIICCS$p.value[multiplecomparisonsCIIICCS$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIIICCS <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")
 

Fcomparesignificance_levelCIIICCS <- round(Fmultiplecomparisons,3)

anovasignificance_levelCIIICCS <- ifelse(twowaypvalueCIIICCS <= 0.05, 
                             ifelse(twowaypvalueCIIICCS <= 0.001, "***", 
                                    ifelse(twowaypvalueCIIICCS <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIIICCS <- max(chapter4resultsfilterCIIICCS$CIIICCS) * 1.5

y_positionFcomparisonCIIICCS <- max(chapter4resultsfilterCIIICCS$CIIICCS[chapter4resultsfilterCIIICCS$SEX == "F"]) * 1.2

y_positionMcomparisonCIIICCS <- max(chapter4resultsfilterCIIICCS$CIIICCS[chapter4resultsfilterCIIICCS$SEX == "M"]) * 1.2

y_positionanovaCIIICCS <- max(chapter4resultsfilterCIIICCS$CIIICCS) * 1.5

CIIICCSeak <- bquote(paste("Complex I+II capacity (CI+II"[E],")"))

#plot of CIIICCS
ggplot(data=chapter4resultsfilterCIIICCS, aes(x=interaction_SEX_TIME, y=CIIICCS)) +
  geom_bar(data = summary_statsCIIICCS,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCIIICCS,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIIICCS,
            aes(x = interaction_SEX_TIME, y = CIIICCS, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Mitochondrial-specific respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1*"•total mito"[VD]^~~~~~-1)))) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIIICCSeak) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 5000),breaks = seq(0, 5000, by = 1000)) +
  geom_signif(
              y_position = y_positionFcomparisonCIIICCS, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelCIIICCS,
              tip_length = 0, family = "sans", size=1, textsize=6) +
   geom_signif(
              y_position = y_positionMcomparisonCIIICCS, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelCIIICCS,
              tip_length = 0, family = "sans", size=1, textsize=8)
```

#Mitochondrial specific respiration (normalisation by CS activity - Appendix IV Fig 7.4.3)
```{r}
chapter4resultsfilterCSratio <- chapter4results %>% 
  dplyr::filter(!is.na(CIIIP))

chapter4resultsfilterCILCSratio <-  chapter4resultsfilterCSratio %>% group_by(ID, TIME) %>%
  mutate(CILCSratio = CIL/CSACTIVE)
chapter4resultsfilterCIPCSratio <-  chapter4resultsfilterCSratio %>% group_by(ID, TIME) %>%
  mutate(CIPCSratio = CIP/CSACTIVE)
chapter4resultsfilterCIIIPCSratio <-  chapter4resultsfilterCSratio %>% group_by(ID, TIME) %>%
  mutate(CIIIPCSratio = CIIIP/CSACTIVE)
chapter4resultsfilterCIIICCSratio <-  chapter4resultsfilterCSratio %>% group_by(ID, TIME) %>%
  mutate(CIIICCSratio = CIIIC/CSACTIVE)

#make each set of data plotted in the right spot
chapter4resultsfilterCILCSratio$TIME <- factor(chapter4resultsfilterCILCSratio$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCILCSratio$interaction_SEX_TIME <- interaction(chapter4resultsfilterCILCSratio$SEX, chapter4resultsfilterCILCSratio$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistics for bars on graph
summary_statsCILCSratio <- chapter4resultsfilterCILCSratio %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CILCSratio),
            sd_value = sd(CILCSratio, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCILCSratio <- aov(CILCSratio ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCILCSratio)
anovaCILCSratio <- summary(anova_resultCILCSratio)
anovaCILCSratio <- as.data.frame(anovaCILCSratio$`Error: ID:TIME`[[1]])
twowaypvalueCILCSratio <- anovaCILCSratio["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCILCSratio)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCILCSratio <- emmeans(anova_resultCILCSratio, ~ TIME | SEX)
multiplecomparisonsCILCSratio <- summary(pairs(multiplecomparisonsCILCSratio), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCILCSratio$p.value[multiplecomparisonsCILCSratio$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCILCSratio$p.value[multiplecomparisonsCILCSratio$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCILCSratio <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCILCSratio <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCILCSratio <- ifelse(twowaypvalueCILCSratio <= 0.05, 
                             ifelse(twowaypvalueCILCSratio <= 0.001, "***", 
                                    ifelse(twowaypvalueCILCSratio <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCILCSratio <- max(chapter4resultsfilterCILCSratio$CILCSratio) * 1.5

y_positionFcomparisonCILCSratio <- max(chapter4resultsfilterCILCSratio$CILCSratio[chapter4resultsfilterCILCSratio$SEX == "F"]) * 1.2

y_positionMcomparisonCILCSratio <- max(chapter4resultsfilterCILCSratio$CILCSratio[chapter4resultsfilterCILCSratio$SEX == "M"]) * 1.2


#plot of CILCSratio
ggplot(data=chapter4resultsfilterCILCSratio, aes(x=interaction_SEX_TIME, y=CILCSratio)) +
  geom_bar(data = summary_statsCILCSratio,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCILCSratio,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCILCSratio,
            aes(x = interaction_SEX_TIME, y = CILCSratio, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Mitochondrial-specific respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1*"•CS"^-1)))) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CILCSeak) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 50), breaks = seq(0, 50, by = 10))


chapter4resultsfilterCIPCSratio$TIME <- factor(chapter4resultsfilterCIPCSratio$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIPCSratio$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIPCSratio$SEX, chapter4resultsfilterCIPCSratio$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiCIPCSratio for bars on graph
summary_statsCIPCSratio <- chapter4resultsfilterCIPCSratio %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIPCSratio),
            sd_value = sd(CIPCSratio, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIPCSratio <- aov(CIPCSratio ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIPCSratio)
anovaCIPCSratio <- summary(anova_resultCIPCSratio)
anovaCIPCSratio <- as.data.frame(anovaCIPCSratio$`Error: ID:TIME`[[1]])
twowaypvalueCIPCSratio <- anovaCIPCSratio["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIPCSratio)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIPCSratio <- emmeans(anova_resultCIPCSratio, ~ TIME | SEX)
multiplecomparisonsCIPCSratio <- summary(pairs(multiplecomparisonsCIPCSratio), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIPCSratio$p.value[multiplecomparisonsCIPCSratio$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCIPCSratio$p.value[multiplecomparisonsCIPCSratio$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIPCSratio <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCIPCSratio <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCIPCSratio <- ifelse(twowaypvalueCIPCSratio <= 0.05, 
                             ifelse(twowaypvalueCIPCSratio <= 0.001, "***", 
                                    ifelse(twowaypvalueCIPCSratio <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIPCSratio <- max(chapter4resultsfilterCIPCSratio$CIPCSratio) * 1.5

y_positionFcomparisonCIPCSratio <- max(chapter4resultsfilterCIPCSratio$CIPCSratio[chapter4resultsfilterCIPCSratio$SEX == "F"]) * 1.2

y_positionMcomparisonCIPCSratio <- max(chapter4resultsfilterCIPCSratio$CIPCSratio[chapter4resultsfilterCIPCSratio$SEX == "M"]) * 1.2


#plot of CIPCSratio
ggplot(data=chapter4resultsfilterCIPCSratio, aes(x=interaction_SEX_TIME, y=CIPCSratio)) +
  geom_bar(data = summary_statsCIPCSratio,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCIPCSratio,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIPCSratio,
            aes(x = interaction_SEX_TIME, y = CIPCSratio, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Mitochondrial-specific respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1*"•CS"^-1)))) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIPeak) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 50), breaks = seq(0, 50, by = 10))
    

#CIIIPCS
chapter4resultsfilterCIIIPCSratio$TIME <- factor(chapter4resultsfilterCIIIPCSratio$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIIIPCSratio$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIIIPCSratio$SEX, chapter4resultsfilterCIIIPCSratio$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiCIIIPCSratio for bars on graph
summary_statsCIIIPCSratio <- chapter4resultsfilterCIIIPCSratio %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIIIPCSratio),
            sd_value = sd(CIIIPCSratio, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIIIPCSratio <- aov(CIIIPCSratio ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIIIPCSratio)
anovaCIIIPCSratio <- summary(anova_resultCIIIPCSratio)
anovaCIIIPCSratio <- as.data.frame(anovaCIIIPCSratio$`Error: ID:TIME`[[1]])
twowaypvalueCIIIPCSratio <- anovaCIIIPCSratio["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIIIPCSratio)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIIIPCSratio <- emmeans(anova_resultCIIIPCSratio, ~ TIME | SEX)
multiplecomparisonsCIIIPCSratio <- summary(pairs(multiplecomparisonsCIIIPCSratio), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIIIPCSratio$p.value[multiplecomparisonsCIIIPCSratio$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCIIIPCSratio$p.value[multiplecomparisonsCIIIPCSratio$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIIIPCSratio <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCIIIPCSratio <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCIIIPCSratio <- ifelse(twowaypvalueCIIIPCSratio <= 0.05, 
                             ifelse(twowaypvalueCIIIPCSratio <= 0.001, "***", 
                                    ifelse(twowaypvalueCIIIPCSratio <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIIIPCSratio <- max(chapter4resultsfilterCIIIPCSratio$CIIIPCSratio) * 1.5

y_positionFcomparisonCIIIPCSratio <- max(chapter4resultsfilterCIIIPCSratio$CIIIPCSratio[chapter4resultsfilterCIIIPCSratio$SEX == "F"]) * 1.2

y_positionMcomparisonCIIIPCSratio <- max(chapter4resultsfilterCIIIPCSratio$CIIIPCSratio[chapter4resultsfilterCIIIPCSratio$SEX == "M"]) * 1.2


#plot of CIIIPCSratio
ggplot(data=chapter4resultsfilterCIIIPCSratio, aes(x=interaction_SEX_TIME, y=CIIIPCSratio)) +
  geom_bar(data = summary_statsCIIIPCSratio,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCIIIPCSratio,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIIIPCSratio,
            aes(x = interaction_SEX_TIME, y = CIIIPCSratio, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Mitochondrial-specific respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1*"•CS"^-1)))) + 
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIIIPeak) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 50), breaks = seq(0, 50, by = 10))


chapter4resultsfilterCIIICCSratio$TIME <- factor(chapter4resultsfilterCIIICCSratio$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIIICCSratio$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIIICCSratio$SEX, chapter4resultsfilterCIIICCSratio$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiCIIICCSratio for bars on graph
summary_statsCIIICCSratio <- chapter4resultsfilterCIIICCSratio %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIIICCSratio),
            sd_value = sd(CIIICCSratio, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIIICCSratio <- aov(CIIICCSratio ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIIICCSratio)
anovaCIIICCSratio <- summary(anova_resultCIIICCSratio)
anovaCIIICCSratio <- as.data.frame(anovaCIIICCSratio$`Error: ID:TIME`[[1]])
twowaypvalueCIIICCSratio <- anovaCIIICCSratio["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIIICCSratio)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIIICCSratio <- emmeans(anova_resultCIIICCSratio, ~ TIME | SEX)
multiplecomparisonsCIIICCSratio <- summary(pairs(multiplecomparisonsCIIICCSratio), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIIICCSratio$p.value[multiplecomparisonsCIIICCSratio$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCIIICCSratio$p.value[multiplecomparisonsCIIICCSratio$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIIICCSratio <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCIIICCSratio <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCIIICCSratio <- ifelse(twowaypvalueCIIICCSratio <= 0.05, 
                             ifelse(twowaypvalueCIIICCSratio <= 0.001, "***", 
                                    ifelse(twowaypvalueCIIICCSratio <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIIICCSratio <- max(chapter4resultsfilterCIIICCSratio$CIIICCSratio) * 1.5

y_positionFcomparisonCIIICCSratio <- max(chapter4resultsfilterCIIICCSratio$CIIICCSratio[chapter4resultsfilterCIIICCSratio$SEX == "F"]) * 1.2

y_positionMcomparisonCIIICCSratio <- max(chapter4resultsfilterCIIICCSratio$CIIICCSratio[chapter4resultsfilterCIIICCSratio$SEX == "M"]) * 1.2


#plot of CIIICCSratio
ggplot(data=chapter4resultsfilterCIIICCSratio, aes(x=interaction_SEX_TIME, y=CIIICCSratio)) +
  geom_bar(data = summary_statsCIIICCSratio,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCIIICCSratio,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIIICCSratio,
            aes(x = interaction_SEX_TIME, y = CIIICCSratio, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression(atop("Mitochondrial-specific respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1*"•CS"^-1)))) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIIICeak) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 50), breaks = seq(0, 50, by = 10))
  
```

#Mitochondrial specific respiration (normalisation by total OXPHOS protein content - Appendix IV Fig 7.4.3)
```{r}
chapter4resultsfilterCSratio <- chapter4results %>% 
  dplyr::filter(!is.na(CIIIP) & !is.na(CI) & !is.na(CV))

chapter4resultsfilterCSratio <-  chapter4resultsfilterCSratio %>% group_by(ID, TIME) %>%
  mutate(OXPHOS = CI + CII + CIII + CIV + CV)

chapter4resultsfilterCILCSratio <-  chapter4resultsfilterCSratio %>% group_by(ID, TIME) %>%
  mutate(CILCSratio = CIL/OXPHOS)
chapter4resultsfilterCIPCSratio <-  chapter4resultsfilterCSratio %>% group_by(ID, TIME) %>%
  mutate(CIPCSratio = CIP/OXPHOS)
chapter4resultsfilterCIIIPCSratio <-  chapter4resultsfilterCSratio %>% group_by(ID, TIME) %>%
  mutate(CIIIPCSratio = CIIIP/OXPHOS)
chapter4resultsfilterCIIICCSratio <-  chapter4resultsfilterCSratio %>% group_by(ID, TIME) %>%
  mutate(CIIICCSratio = CIIIC/OXPHOS)

#make each set of data plotted in the right spot
chapter4resultsfilterCILCSratio$TIME <- factor(chapter4resultsfilterCILCSratio$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCILCSratio$interaction_SEX_TIME <- interaction(chapter4resultsfilterCILCSratio$SEX, chapter4resultsfilterCILCSratio$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiCILCSratio for bars on graph
summary_statsCILCSratio <- chapter4resultsfilterCILCSratio %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CILCSratio),
            sd_value = sd(CILCSratio, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCILCSratio <- aov(CILCSratio ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCILCSratio)
anovaCILCSratio <- summary(anova_resultCILCSratio)
anovaCILCSratio <- as.data.frame(anovaCILCSratio$`Error: ID:TIME`[[1]])
twowaypvalueCILCSratio <- anovaCILCSratio["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCILCSratio)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCILCSratio <- emmeans(anova_resultCILCSratio, ~ TIME | SEX)
multiplecomparisonsCILCSratio <- summary(pairs(multiplecomparisonsCILCSratio), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCILCSratio$p.value[multiplecomparisonsCILCSratio$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCILCSratio$p.value[multiplecomparisonsCILCSratio$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCILCSratio <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCILCSratio <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCILCSratio <- ifelse(twowaypvalueCILCSratio <= 0.05, 
                             ifelse(twowaypvalueCILCSratio <= 0.001, "***", 
                                    ifelse(twowaypvalueCILCSratio <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCILCSratio <- max(chapter4resultsfilterCILCSratio$CILCSratio) * 1.5

y_positionFcomparisonCILCSratio <- max(chapter4resultsfilterCILCSratio$CILCSratio[chapter4resultsfilterCILCSratio$SEX == "F"]) * 1.2

y_positionMcomparisonCILCSratio <- max(chapter4resultsfilterCILCSratio$CILCSratio[chapter4resultsfilterCILCSratio$SEX == "M"]) * 1.2


#plot of CILCSratio
ggplot(data=chapter4resultsfilterCILCSratio, aes(x=interaction_SEX_TIME, y=CILCSratio)) + geom_bar(data = summary_statsCILCSratio,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb", "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
    geom_errorbar(data = summary_statsCILCSratio,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value), inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCILCSratio,
            aes(x = interaction_SEX_TIME, y = CILCSratio, fill = interaction_SEX_TIME), height = 0, width = 0.175,
      
             size = 3,
            shape = 21,
             colour = "black", alpha = 1.0,
            stroke = 1.5,
             show.legend = FALSE) + 
  labs(y =expression(atop("Mitochondrial-specific respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1*"•OXPHOS"^-1)))) +   
       scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CILCSeak) +
  theme_classic() +
    theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 80), breaks = seq(0, 80, by = 10))


chapter4resultsfilterCIPCSratio$TIME <- factor(chapter4resultsfilterCIPCSratio$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIPCSratio$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIPCSratio$SEX, chapter4resultsfilterCIPCSratio$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiCIPCSratio for bars on graph
summary_statsCIPCSratio <- chapter4resultsfilterCIPCSratio %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIPCSratio),
            sd_value = sd(CIPCSratio, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIPCSratio <- aov(CIPCSratio ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIPCSratio)
anovaCIPCSratio <- summary(anova_resultCIPCSratio)
anovaCIPCSratio <- as.data.frame(anovaCIPCSratio$`Error: ID:TIME`[[1]])
twowaypvalueCIPCSratio <- anovaCIPCSratio["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIPCSratio)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIPCSratio <- emmeans(anova_resultCIPCSratio, ~ TIME | SEX)
multiplecomparisonsCIPCSratio <- summary(pairs(multiplecomparisonsCIPCSratio), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIPCSratio$p.value[multiplecomparisonsCIPCSratio$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCIPCSratio$p.value[multiplecomparisonsCIPCSratio$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIPCSratio <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCIPCSratio <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCIPCSratio <- ifelse(twowaypvalueCIPCSratio <= 0.05, 
                             ifelse(twowaypvalueCIPCSratio <= 0.001, "***", 
                                    ifelse(twowaypvalueCIPCSratio <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIPCSratio <- max(chapter4resultsfilterCIPCSratio$CIPCSratio) * 1.5

y_positionFcomparisonCIPCSratio <- max(chapter4resultsfilterCIPCSratio$CIPCSratio[chapter4resultsfilterCIPCSratio$SEX == "F"]) * 1.2

y_positionMcomparisonCIPCSratio <- max(chapter4resultsfilterCIPCSratio$CIPCSratio[chapter4resultsfilterCIPCSratio$SEX == "M"]) * 1.2


#plot of CIPCSratio
ggplot(data=chapter4resultsfilterCIPCSratio, aes(x=interaction_SEX_TIME, y=CIPCSratio)) + geom_bar(data = summary_statsCIPCSratio,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb", "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
    geom_errorbar(data = summary_statsCIPCSratio,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value), inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIPCSratio,
            aes(x = interaction_SEX_TIME, y = CIPCSratio, fill = interaction_SEX_TIME), height = 0, width = 0.175,
      
             size = 3,
            shape = 21,
             colour = "black", alpha = 1.0,
            stroke = 1.5,
             show.legend = FALSE) + 
  labs(y =expression(atop("Mitochondrial-specific respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1*"•OXPHOS"^-1)))) +   
       scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIPeak) +
  theme_classic() +
    theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 80), breaks = seq(0, 80, by = 10))
    

#CIIIPCS
chapter4resultsfilterCIIIPCSratio$TIME <- factor(chapter4resultsfilterCIIIPCSratio$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIIIPCSratio$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIIIPCSratio$SEX, chapter4resultsfilterCIIIPCSratio$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiCIIIPCSratio for bars on graph
summary_statsCIIIPCSratio <- chapter4resultsfilterCIIIPCSratio %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIIIPCSratio),
            sd_value = sd(CIIIPCSratio, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIIIPCSratio <- aov(CIIIPCSratio ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIIIPCSratio)
anovaCIIIPCSratio <- summary(anova_resultCIIIPCSratio)
anovaCIIIPCSratio <- as.data.frame(anovaCIIIPCSratio$`Error: ID:TIME`[[1]])
twowaypvalueCIIIPCSratio <- anovaCIIIPCSratio["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIIIPCSratio)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIIIPCSratio <- emmeans(anova_resultCIIIPCSratio, ~ TIME | SEX)
multiplecomparisonsCIIIPCSratio <- summary(pairs(multiplecomparisonsCIIIPCSratio), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIIIPCSratio$p.value[multiplecomparisonsCIIIPCSratio$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCIIIPCSratio$p.value[multiplecomparisonsCIIIPCSratio$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIIIPCSratio <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCIIIPCSratio <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCIIIPCSratio <- ifelse(twowaypvalueCIIIPCSratio <= 0.05, 
                             ifelse(twowaypvalueCIIIPCSratio <= 0.001, "***", 
                                    ifelse(twowaypvalueCIIIPCSratio <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIIIPCSratio <- max(chapter4resultsfilterCIIIPCSratio$CIIIPCSratio) * 1.5

y_positionFcomparisonCIIIPCSratio <- max(chapter4resultsfilterCIIIPCSratio$CIIIPCSratio[chapter4resultsfilterCIIIPCSratio$SEX == "F"]) * 1.2

y_positionMcomparisonCIIIPCSratio <- max(chapter4resultsfilterCIIIPCSratio$CIIIPCSratio[chapter4resultsfilterCIIIPCSratio$SEX == "M"]) * 1.2


#plot of CIIIPCSratio
ggplot(data=chapter4resultsfilterCIIIPCSratio, aes(x=interaction_SEX_TIME, y=CIIIPCSratio)) + geom_bar(data = summary_statsCIIIPCSratio,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb", "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
    geom_errorbar(data = summary_statsCIIIPCSratio,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value), inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIIIPCSratio,
            aes(x = interaction_SEX_TIME, y = CIIIPCSratio, fill = interaction_SEX_TIME), height = 0, width = 0.175,
      
             size = 3,
            shape = 21,
             colour = "black", alpha = 1.0,
            stroke = 1.5,
             show.legend = FALSE) + 
  labs(y =expression(atop("Mitochondrial-specific respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1*"•OXPHOS"^-1)))) + 
       scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIIIPeak) +
  theme_classic() +
    theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 80), breaks = seq(0, 80, by = 10))

chapter4resultsfilterCIIICCSratio$TIME <- factor(chapter4resultsfilterCIIICCSratio$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIIICCSratio$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIIICCSratio$SEX, chapter4resultsfilterCIIICCSratio$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiCIIICCSratio for bars on graph
summary_statsCIIICCSratio <- chapter4resultsfilterCIIICCSratio %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIIICCSratio),
            sd_value = sd(CIIICCSratio, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIIICCSratio <- aov(CIIICCSratio ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIIICCSratio)
anovaCIIICCSratio <- summary(anova_resultCIIICCSratio)
anovaCIIICCSratio <- as.data.frame(anovaCIIICCSratio$`Error: ID:TIME`[[1]])
twowaypvalueCIIICCSratio <- anovaCIIICCSratio["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIIICCSratio)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIIICCSratio <- emmeans(anova_resultCIIICCSratio, ~ TIME | SEX)
multiplecomparisonsCIIICCSratio <- summary(pairs(multiplecomparisonsCIIICCSratio), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIIICCSratio$p.value[multiplecomparisonsCIIICCSratio$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCIIICCSratio$p.value[multiplecomparisonsCIIICCSratio$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIIICCSratio <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCIIICCSratio <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCIIICCSratio <- ifelse(twowaypvalueCIIICCSratio <= 0.05, 
                             ifelse(twowaypvalueCIIICCSratio <= 0.001, "***", 
                                    ifelse(twowaypvalueCIIICCSratio <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIIICCSratio <- max(chapter4resultsfilterCIIICCSratio$CIIICCSratio) * 1.5

y_positionFcomparisonCIIICCSratio <- max(chapter4resultsfilterCIIICCSratio$CIIICCSratio[chapter4resultsfilterCIIICCSratio$SEX == "F"]) * 1.2

y_positionMcomparisonCIIICCSratio <- max(chapter4resultsfilterCIIICCSratio$CIIICCSratio[chapter4resultsfilterCIIICCSratio$SEX == "M"]) * 1.2


#plot of CIIICCSratio
ggplot(data=chapter4resultsfilterCIIICCSratio, aes(x=interaction_SEX_TIME, y=CIIICCSratio)) + geom_bar(data = summary_statsCIIICCSratio,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb", "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
    geom_errorbar(data = summary_statsCIIICCSratio,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value), inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIIICCSratio,
            aes(x = interaction_SEX_TIME, y = CIIICCSratio, fill = interaction_SEX_TIME), height = 0, width = 0.175,
      
             size = 3,
            shape = 21,
             colour = "black", alpha = 1.0,
            stroke = 1.5,
             show.legend = FALSE) + 
  labs(y =expression(atop("Mitochondrial-specific respiration", (pmol ~ O[2]*"•"*s^-1*"•mg of wet weight"^-1*"•OXPHOS"^-1)))) +   
       scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIIICeak) +
  theme_classic() +
    theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 80), breaks = seq(0, 80, by = 10))
```

#Ratio of fission to fusion (Fig 4.6A)
```{r}
chapter4resultsfiltermorphology <- chapter4results %>% 
  dplyr::filter(!is.na(FIS1WB) & !is.na(DRP1WB) & !is.na(MFN2WB) & !is.na(OPA1WB))

chapter4resultsfiltermorphology <-  chapter4resultsfiltermorphology %>% group_by(ID, TIME) %>%
  mutate(Fission = FIS1WB + DRP1WB) %>%
  mutate(Fusion = MFN2WB + OPA1WB) %>%
  mutate(morphology = Fusion / Fission)

chapter4resultsfiltermorphology <- chapter4resultsfiltermorphology %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(morphology)) | 
         !(any(TIME == "POST") & any(is.na(morphology))))

#make each set of data plotted in the right spot
chapter4resultsfiltermorphology$TIME <- factor(chapter4resultsfiltermorphology$TIME, levels = c("PRE", "POST"))

#get summary statistics for bars on graph
summary_statsmorphology <- chapter4resultsfiltermorphology %>%
  group_by(TIME) %>%
  summarise(mean_value = mean(morphology),
            sd_value = sd(morphology, na.rm = TRUE))

data_PRE <- subset(chapter4resultsfiltermorphology, TIME == "PRE")
data_POST <- subset(chapter4resultsfiltermorphology, TIME == "POST")

# Perform t-test
t_test_result <- t.test(data_PRE$morphology, data_POST$morphology, paired = TRUE)
ttestpval <- t_test_result$p.value

significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
comparesignificance_level <- ifelse(ttestpval <= 0.05, 
                             ifelse(ttestpval <= 0.001, "***", 
                                    ifelse(ttestpval <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsmorphology <- max(chapter4resultsfiltermorphology$morphology) * 1.5

y_positionttestmorphology <- max(chapter4resultsfiltermorphology$morphology) * 1.5

#plot of morphology
ggplot(data=chapter4resultsfiltermorphology, aes(x=TIME, y=morphology)) +
  geom_bar(data = summary_statsmorphology,
           aes(x=TIME, y = mean_value),
           stat = "identity",
           position = "identity",
           fill = "white",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M" = "#94e2eb",
                               "F" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsmorphology,
           aes(x = TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfiltermorphology,
            aes(x = TIME, y = morphology, fill = SEX),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression("Ratio of (MFN2+OPA1)•(DRP1+FIS1)"^-1~"protein content (A.U.)")) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("Ratio of fusion and fission regulators") +
  theme_classic() +
   theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 3),breaks = seq(0, 3, by = 0.5)) +
  geom_signif(
              y_position = y_positionttestmorphology, xmin = c(1), xmax = (2),
              annotation = comparesignificance_level, tip_length = 0, family = "sans", size=1, textsize=8)
```

#Cristae density (Fig 4.6B)
```{r}
#filter out those who did not complete the measurements
chapter4resultsfilterCRISTAE <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(CRISTAE)) | 
         !(any(TIME == "POST") & any(is.na(CRISTAE))))

#make each set of data plotted in the right spot
chapter4resultsfilterCRISTAE$TIME <- factor(chapter4resultsfilterCRISTAE$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCRISTAE$interaction_SEX_TIME <- interaction(chapter4resultsfilterCRISTAE$SEX, chapter4resultsfilterCRISTAE$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiCRISTAE for bars on graph
summary_statsCRISTAE <- chapter4resultsfilterCRISTAE %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CRISTAE),
            sd_value = sd(CRISTAE, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCRISTAE <- aov(CRISTAE ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCRISTAE)
anovaCRISTAE <- summary(anova_resultCRISTAE)
summary(anova_resultCRISTAE)
anovaCRISTAE <- as.data.frame(anovaCRISTAE$`Error: ID:TIME`[[1]])
twowaypvalueCRISTAE <- anovaCRISTAE["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCRISTAE)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCRISTAE <- emmeans(anova_resultCRISTAE, ~ TIME | SEX)
multiplecomparisonsCRISTAE <- summary(pairs(multiplecomparisonsCRISTAE), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCRISTAE$p.value[multiplecomparisonsCRISTAE$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsCRISTAE$p.value[multiplecomparisonsCRISTAE$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCRISTAE <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCRISTAE <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCRISTAE <- ifelse(twowaypvalueCRISTAE <= 0.05, 
                             ifelse(twowaypvalueCRISTAE <= 0.001, "***", 
                                    ifelse(twowaypvalueCRISTAE <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCRISTAE <- max(chapter4resultsfilterCRISTAE$CRISTAE) * 1.5

y_positionFcomparisonCRISTAE <- max(chapter4resultsfilterCRISTAE$CRISTAE[chapter4resultsfilterCRISTAE$SEX == "F"]) * 1.2

y_positionMcomparisonCRISTAE <- max(chapter4resultsfilterCRISTAE$CRISTAE[chapter4resultsfilterCRISTAE$SEX == "M"]) * 1.2

y_positionanovaCRISTAE <- max(chapter4resultsfilterCRISTAE$CRISTAE) * 1.5

#plot of CRISTAE
ggplot(data=chapter4resultsfilterCRISTAE, aes(x=interaction_SEX_TIME, y=CRISTAE)) +
  geom_bar(data = summary_statsCRISTAE,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCRISTAE,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCRISTAE,
            aes(x = interaction_SEX_TIME, y = CRISTAE, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression("Cristae density (µm"^2*"•µm"^-3*")")) +
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("Cristae density") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 35), breaks = seq(0, 35, by = 5))
```

#Mito profiles (Fig 4.6D & 4.6E & 4.6F)
```{r}
TEMtraceparticipants <- openxlsx::read.xlsx("data/Traces TEM participants fix.xlsx")
TEMtraceparticipants <- na.omit(TEMtraceparticipants)
TEMtraceparticipants$TIME <- factor(TEMtraceparticipants$TIME, levels = c("PRE", "POST"))
TEMtraceparticipants$SEX <- factor(TEMtraceparticipants$SEX, levels = c("F", "M"))

# Create interaction term
TEMtraceparticipants$interaction_SEX_TIME <- interaction(TEMtraceparticipants$SEX, TEMtraceparticipants$TIME, drop = TRUE, lex.order = TRUE)

# Calculate mean stats for each interaction term and location
summary_statsMitoprofiles <- TEMtraceparticipants %>%
  group_by(interaction_SEX_TIME, Location) %>%
  summarise(mean_value = mean(Mitoprofiles),
            sd_value = sd(Mitoprofiles,na.rm = TRUE))

#get just the one location
TEMtraceparticipantssM <- TEMtraceparticipants %>%
  dplyr::filter(Location == "sM")

# Performing two-way ANOVA
anova_resultMitoprofiles <- aov(Mitoprofiles ~ SEX * TIME + Error(ID/TIME), data = TEMtraceparticipantssM)
summary(anova_resultMitoprofiles)
anovaMitoprofiles <- summary(anova_resultMitoprofiles)
anovaMitoprofiles <- as.data.frame(anovaMitoprofiles$`Error: ID:TIME`[[1]])
twowaypvalueMitoprofiles <- anovaMitoprofiles["SEX:TIME", "Pr(>F)"]
print(twowaypvalueMitoprofiles)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsMitoprofiles <- emmeans(anova_resultMitoprofiles, ~ TIME | SEX)
multiplecomparisonsMitoprofiles <- summary(pairs(multiplecomparisonsMitoprofiles), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsMitoprofiles$p.value[multiplecomparisonsMitoprofiles$SEX == "F"]

Mmultiplecomparisons <- multiplecomparisonsMitoprofiles$p.value[multiplecomparisonsMitoprofiles$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)

Mcomparesignificance_levelMitoprofiles <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelMitoprofiles <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelMitoprofiles <- ifelse(twowaypvalueMitoprofiles <= 0.05, 
                             ifelse(twowaypvalueMitoprofiles <= 0.001, "***", 
                                    ifelse(twowaypvalueMitoprofiles <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsMitoprofiles <- max(TEMtraceparticipantssM$Mitoprofiles) * 1.5

y_positionFcomparisonMitoprofiles <- max(TEMtraceparticipantssM$Mitoprofiles[TEMtraceparticipantssM$SEX == "F"]) * 1.2

y_positionMcomparisonMitoprofiles <- max(TEMtraceparticipantssM$Mitoprofiles[TEMtraceparticipantssM$SEX == "M"]) * 1.2

y_positionanovaMitoprofiles <- max(TEMtraceparticipantssM$Mitoprofiles) * 1.5

#plot of Mitoprofiles
ggplot(data=TEMtraceparticipantssM, aes(x=interaction_SEX_TIME, y=Mitoprofiles)) +
  geom_bar(data = summary_statsMitoprofiles %>% dplyr::filter(Location == "sM"),
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsMitoprofiles %>% dplyr::filter(Location == "sM"),
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = TEMtraceparticipantssM,
            aes(x = interaction_SEX_TIME, y = Mitoprofiles, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y = expression("Mito profiles (# " * mu * "m"^3 * ")")) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("<span style='color:#edd068'> Superficial </span>mito profiles") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 3.5), breaks = seq(0, 3.5, by = 0.5)) +
  geom_signif(
              y_position = y_positionFcomparisonMitoprofiles, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelMitoprofiles,
              tip_length = 0, family = "sans", size=1, textsize=8) +
  geom_signif(
              y_position = y_positionMcomparisonMitoprofiles, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelMitoprofiles,
              tip_length = 0, family = "sans", size=1, textsize=8) +
  theme(plot.title = element_markdown())

#get just the one location
TEMtraceparticipantscM <- TEMtraceparticipants %>%
  dplyr::filter(Location == "cM")

# Performing two-way ANOVA
anova_resultMitoprofiles <- aov(Mitoprofiles ~ SEX * TIME + Error(ID/TIME), data = TEMtraceparticipantscM)
summary(anova_resultMitoprofiles)
anovaMitoprofiles <- summary(anova_resultMitoprofiles)
anovaMitoprofiles <- as.data.frame(anovaMitoprofiles$`Error: ID:TIME`[[1]])
twowaypvalueMitoprofiles <- anovaMitoprofiles["SEX:TIME", "Pr(>F)"]
print(twowaypvalueMitoprofiles)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisoncMitoprofiles <- emmeans(anova_resultMitoprofiles, ~ TIME | SEX)
multiplecomparisoncMitoprofiles <- summary(pairs(multiplecomparisoncMitoprofiles), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisoncMitoprofiles$p.value[multiplecomparisoncMitoprofiles$SEX == "F"]

Mmultiplecomparisons <- multiplecomparisoncMitoprofiles$p.value[multiplecomparisoncMitoprofiles$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)

Mcomparesignificance_levelMitoprofiles <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelMitoprofiles <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelMitoprofiles <- ifelse(twowaypvalueMitoprofiles <= 0.05, 
                             ifelse(twowaypvalueMitoprofiles <= 0.001, "***", 
                                    ifelse(twowaypvalueMitoprofiles <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitcMitoprofiles <- max(TEMtraceparticipantscM$Mitoprofiles) * 1.5

y_positionFcomparisonMitoprofiles <- max(TEMtraceparticipantscM$Mitoprofiles[TEMtraceparticipantscM$SEX == "F"]) * 1.2

y_positionMcomparisonMitoprofiles <- max(TEMtraceparticipantscM$Mitoprofiles[TEMtraceparticipantscM$SEX == "M"]) * 1.2

y_positionanovaMitoprofiles <- max(TEMtraceparticipantscM$Mitoprofiles) * 1.5

#plot of Mitoprofiles
ggplot(data=TEMtraceparticipantscM, aes(x=interaction_SEX_TIME, y=Mitoprofiles)) +
  geom_bar(data = summary_statsMitoprofiles %>% dplyr::filter(Location == "cM"),
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsMitoprofiles %>% dplyr::filter(Location == "cM"),
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = TEMtraceparticipantscM,
            aes(x = interaction_SEX_TIME, y = Mitoprofiles, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y = expression("Mito profiles (# " * mu * "m"^3 * ")")) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("<span style='color:#fa7070'> Central </span>mito profiles") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 3.5), breaks = seq(0, 3.5, by = 0.5)) + 
  theme(plot.title = element_markdown())

#get just the one location
TEMtraceparticipantsSS <- TEMtraceparticipants %>%
  dplyr::filter(Location == "SS")

# Performing two-way ANOVA
anova_resultMitoprofiles <- aov(Mitoprofiles ~ SEX * TIME + Error(ID/TIME), data = TEMtraceparticipantsSS)
summary(anova_resultMitoprofiles)
anovaMitoprofiles <- summary(anova_resultMitoprofiles)
anovaMitoprofiles <- as.data.frame(anovaMitoprofiles$`Error: ID:TIME`[[1]])
twowaypvalueMitoprofiles <- anovaMitoprofiles["SEX:TIME", "Pr(>F)"]
print(twowaypvalueMitoprofiles)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonSSitoprofiles <- emmeans(anova_resultMitoprofiles, ~ TIME | SEX)
multiplecomparisonSSitoprofiles <- summary(pairs(multiplecomparisonSSitoprofiles), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonSSitoprofiles$p.value[multiplecomparisonSSitoprofiles$SEX == "F"]

Mmultiplecomparisons <- multiplecomparisonSSitoprofiles$p.value[multiplecomparisonSSitoprofiles$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)

Mcomparesignificance_levelMitoprofiles <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelMitoprofiles <- round(Fmultiplecomparisons,3)

anovasignificance_levelMitoprofiles <- ifelse(twowaypvalueMitoprofiles <= 0.05, 
                             ifelse(twowaypvalueMitoprofiles <= 0.001, "***", 
                                    ifelse(twowaypvalueMitoprofiles <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitSSitoprofiles <- max(TEMtraceparticipantsSS$Mitoprofiles) * 1.5

y_positionFcomparisonMitoprofiles <- max(TEMtraceparticipantsSS$Mitoprofiles[TEMtraceparticipantsSS$SEX == "F"]) * 1.2

y_positionMcomparisonMitoprofiles <- max(TEMtraceparticipantsSS$Mitoprofiles[TEMtraceparticipantsSS$SEX == "M"]) * 1.2

y_positionanovaMitoprofiles <- max(TEMtraceparticipantsSS$Mitoprofiles) * 1.5

#plot of Mitoprofiles
ggplot(data=TEMtraceparticipantsSS, aes(x=interaction_SEX_TIME, y=Mitoprofiles)) +
  geom_bar(data = summary_statsMitoprofiles %>% dplyr::filter(Location == "SS"),
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsMitoprofiles %>% dplyr::filter(Location == "SS"),
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = TEMtraceparticipantsSS,
            aes(x = interaction_SEX_TIME, y = Mitoprofiles, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y = expression("Mito profiles (# " * mu * "m"^2 * ")")) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("<span style='color:#8bde64'> Subsarcolemmal </span>mito profiles") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 5),breaks = seq(0, 5, by = 0.5))  +
  geom_signif(
              y_position = y_positionFcomparisonMitoprofiles, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelMitoprofiles,
              tip_length = 0, family = "sans", size=1, textsize=6) +
   geom_signif(
              y_position = y_positionMcomparisonMitoprofiles, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelMitoprofiles,
              tip_length = 0, family = "sans", size=1, textsize=8) + theme(plot.title = element_markdown())
```

#TEM area (Fig 4.6D & 4.6E & 4.6F)
```{r}
TEMtracetotal <- openxlsx::read.xlsx("data/Traces TEM total fix.xlsx")
TEMtracetotal <- na.omit(TEMtracetotal)
TEMtracetotal$TIME <- factor(TEMtracetotal$TIME, levels = c("PRE", "POST"))
TEMtracetotal$SEX <- factor(TEMtracetotal$SEX, levels = c("M", "F"))

# Create interaction term
TEMtracetotal$interaction_SEX_TIME <- interaction(TEMtracetotal$SEX, TEMtracetotal$TIME, drop = TRUE, lex.order = TRUE)

# Calculate mean area for each interaction term and location
TEMtracearea <- TEMtracetotal %>%
  group_by(interaction_SEX_TIME, Location) %>%
  summarise(mean_area = mean(Area, na.rm = TRUE))

# Create the density plot
ggplot(TEMtracetotal %>% dplyr::filter(Location == "SS"), aes(x = Area, colour = interaction_SEX_TIME)) + 
  geom_density(size = 2, alpha = 5, show.legend = FALSE) +
  scale_colour_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#34d8eb",
                                 "F.PRE" = "#e3b3e0", "F.POST" = "#e887e3"),
                    name = "Group",
                    labels = c("M.PRE" ="Men PRE", "M.POST" = "Men POST",
                               "F.PRE" = "Women PRE", "F.POST" = "Women POST")) + 
  labs(x = NULL, y = "Density distribution (%)") +
  geom_vline(data = TEMtracearea %>% dplyr::filter(Location == "SS"),
             aes(xintercept = mean_area, colour = interaction_SEX_TIME),
             linetype = "dashed", size = 1.5, show.legend=FALSE) +
  ggtitle(paste0("<span style='color:#8bde64'>Subsarcolemmal </span>area (µm<sup>2</sup>)")) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45, vjust = 1)) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 20),breaks = seq(5, 20, by = 5)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0.05)), limits = c(0,0.3)) +
  theme(plot.title = element_markdown()) +
  guides(colour = guide_legend(override.aes = list(linetype = "solid", size = 2)))

graph2doc(file="plot1.docx", width=4,height=4.5)

ggplot(TEMtracetotal %>% dplyr::filter(Location == "cM"), aes(x= Area,colour=interaction_SEX_TIME)) + 
  geom_density(size = 2, alpha = 5, show.legend = FALSE) +
  scale_colour_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#34d8eb",
                                 "F.PRE" = "#e3b3e0", "F.POST" = "#e887e3"),
                    name = "Group",
                    labels = c("M.PRE" ="Men PRE", "M.POST" = "Men POST",
                               "F.PRE" = "Women PRE", "F.POST" = "Women POST")) + 
  labs(x = NULL, y = "Density distribution (%)") +
  geom_vline(data = TEMtracearea %>% dplyr::filter(Location == "cM"),
             aes(xintercept = mean_area, colour = interaction_SEX_TIME),
             linetype = "dashed", size =1.5, show.legend = FALSE) +
  ggtitle(paste0("<span style='color:#fa7070'> Central </span>area (µm<sup>2</sup>)")) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45, vjust = 1)) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 20), breaks = seq(5, 20, by = 5)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0.05)), limits = c(0,0.3)) +
  theme(plot.title = element_markdown()) +
  guides(colour = guide_legend(override.aes = list(linetype = "solid", size = 2)))

graph2doc(file="plot2.docx", width=4,height=4.5)

ggplot(TEMtracetotal %>% dplyr::filter(Location == "sM"), aes(x= Area,colour=interaction_SEX_TIME)) + 
  geom_density(size = 2, alpha = 5, show.legend = FALSE) +
  scale_colour_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#34d8eb",
                                 "F.PRE" = "#e3b3e0", "F.POST" = "#e887e3"),
                    name = "Group",
                    labels = c("M.PRE" ="Men PRE", "M.POST" = "Men POST",
                               "F.PRE" = "Women PRE", "F.POST" = "Women POST")) + 
  labs(x = NULL, y = "Density distribution (%)") +
  geom_vline(data = TEMtracearea %>% dplyr::filter(Location == "sM"),
             aes(xintercept = mean_area, colour = interaction_SEX_TIME),
             linetype = "dashed", size =1.5, show.legend=FALSE) +
  ggtitle(paste0("<span style='color:#edd068'> Superficial </span>area (µm<sup>2</sup>)")) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45, vjust = 1)) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 20), breaks = seq(5, 20, by = 5)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0.05)), limits = c(0,0.3)) +
  theme(plot.title = element_markdown()) +
  guides(colour = guide_legend(override.aes = list(linetype = "solid", size = 2)))

graph2doc(file="plot3.docx", width=4,height=4.5)
```

#TEM form factor (Fig 4.6D & 4.6E & 4.6F)
```{r}
TEMtraceFormfactor <- TEMtracetotal %>%
  group_by(interaction_SEX_TIME, Location) %>%
  summarise(mean_Formfactor = mean(Formfactor, na.rm = TRUE))

# Create the density plot
ggplot(TEMtracetotal %>% dplyr::filter(Location == "SS"), aes(x = Formfactor, colour = interaction_SEX_TIME)) + 
  geom_density(size = 2, alpha = 5, show.legend = FALSE) +
  scale_colour_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#34d8eb",
                                 "F.PRE" = "#e3b3e0", "F.POST" = "#e887e3"),
                    name = "Group",
                    labels = c("M.PRE" ="Men PRE", "M.POST" = "Men POST",
                               "F.PRE" = "Women PRE", "F.POST" = "Women POST")) + 
  labs(x = NULL, y = "Density distribution (%)") +
  geom_vline(data = TEMtraceFormfactor %>% dplyr::filter(Location == "SS"),
             aes(xintercept = mean_Formfactor, colour = interaction_SEX_TIME),
             linetype = "dashed", size = 1.5, show.legend=FALSE) +
  ggtitle(paste0("<span style='color:#8bde64'>Subsarcolemmal </span>form factor (A.U.)")) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45, vjust = 1)) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 6),breaks = seq(0, 6, by = 1)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0)), limits = c(0.9, 2.05),breaks = seq(1, 2, by = 0.2)) +
  theme(plot.title = element_markdown()) +
  guides(colour = guide_legend(override.aes = list(linetype = "solid", size = 2)))

graph2doc(file="plot4.docx", width=4,height=4.5)

ggplot(TEMtracetotal %>% dplyr::filter(Location == "cM"), aes(x= Formfactor,colour=interaction_SEX_TIME)) + 
  geom_density(size = 2, alpha = 5, show.legend = FALSE) +
  scale_colour_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#34d8eb",
                                 "F.PRE" = "#e3b3e0", "F.POST" = "#e887e3"),
                    name = "Group",
                    labels = c("M.PRE" ="Men PRE", "M.POST" = "Men POST",
                               "F.PRE" = "Women PRE", "F.POST" = "Women POST")) + 
  labs(x = NULL, y = "Density distribution (%)") +
  geom_vline(data = TEMtraceFormfactor %>% dplyr::filter(Location == "cM"),
             aes(xintercept = mean_Formfactor, colour = interaction_SEX_TIME),
             linetype = "dashed", size =1.5, show.legend = FALSE) +
  ggtitle(paste0("<span style='color:#fa7070'> Central </span>form factor (A.U.)")) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45, vjust = 1)) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 6), breaks = seq(0, 6, by = 1)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0)), limits = c(0.9, 2.05), breaks = seq(1, 2, by = 0.2)) +
  theme(plot.title = element_markdown()) +
  guides(colour = guide_legend(override.aes = list(linetype = "solid", size = 2)))

graph2doc(file="plot5.docx", width=4,height=4.5)

ggplot(TEMtracetotal %>% dplyr::filter(Location == "sM"), aes(x= Formfactor,colour=interaction_SEX_TIME)) + 
  geom_density(size = 2, alpha = 5, show.legend = FALSE) +
  scale_colour_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#34d8eb",
                                 "F.PRE" = "#e3b3e0", "F.POST" = "#e887e3"),
                    name = "Group",
                    labels = c("M.PRE" ="Men PRE", "M.POST" = "Men POST",
                               "F.PRE" = "Women PRE", "F.POST" = "Women POST")) + 
  labs(x = NULL, y = "Density distribution (%)") +
  geom_vline(data = TEMtraceFormfactor %>% dplyr::filter(Location == "sM"),
             aes(xintercept = mean_Formfactor, colour = interaction_SEX_TIME),
             linetype = "dashed", size =1.5, show.legend=FALSE) +
  ggtitle(paste0("<span style='color:#edd068'> Superficial </span>form factor (A.U.)")) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45, vjust = 1)) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 6), breaks = seq(0, 6, by = 1)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0)), limits = c(0.9, 2.05), breaks = seq(1, 2, by = 0.2)) +
  theme(plot.title = element_markdown()) +
  guides(colour = guide_legend(override.aes = list(linetype = "solid", size = 2)))

graph2doc(file="plot6.docx", width=4,height=4.5)
```

#TEM roundness (Fig 4.6D & 4.6E & 4.6F)
```{r}
TEMtraceRoundness <- TEMtracetotal %>%
  group_by(interaction_SEX_TIME, Location) %>%
  summarise(mean_Roundness = mean(Roundness, na.rm = TRUE))

# Create the density plot
ggplot(TEMtracetotal %>% dplyr::filter(Location == "SS"), aes(x = Roundness, colour = interaction_SEX_TIME)) + 
  geom_density(size = 2, alpha = 5, show.legend = FALSE) +
  scale_colour_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#34d8eb",
                                 "F.PRE" = "#e3b3e0", "F.POST" = "#e887e3"),
                    name = "Group",
                    labels = c("M.PRE" ="Men PRE", "M.POST" = "Men POST",
                               "F.PRE" = "Women PRE", "F.POST" = "Women POST")) + 
  labs(x = NULL, y = "Density distribution (%)") +
  geom_vline(data = TEMtraceRoundness %>% dplyr::filter(Location == "SS"),
             aes(xintercept = mean_Roundness, colour = interaction_SEX_TIME),
             linetype = "dashed", size = 1.5, show.legend=FALSE) +
  ggtitle(paste0("<span style='color:#8bde64'>Subsarcolemmal </span>roundness (A.U.)")) + 
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45, vjust = 1)) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)),
                     limits= c(0, 3),breaks = seq(0, 3, by = 0.5)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0.05)),
                     limits = c(0, 1.02), breaks = seq(0.2, 1, by = 0.2)) +
  theme(plot.title = element_markdown()) +
  guides(colour = guide_legend(override.aes = list(linetype = "solid", size = 2)))

graph2doc(file="plot7.docx", width=4,height=4.5)

ggplot(TEMtracetotal %>% dplyr::filter(Location == "cM"), aes(x= Roundness,colour=interaction_SEX_TIME)) + 
  geom_density(size = 2, alpha = 5, show.legend = FALSE) +
  scale_colour_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#34d8eb",
                                  "F.PRE" = "#e3b3e0", "F.POST" = "#e887e3"),
                    name = "Group",
                    labels = c("M.PRE" ="Men PRE", "M.POST" = "Men POST",
                               "F.PRE" = "Women PRE", "F.POST" = "Women POST")) + theme_classic() +
  labs(x = NULL, y = "Density distribution (%)") +
  geom_vline(data = TEMtraceRoundness %>% dplyr::filter(Location == "cM"),
             aes(xintercept = mean_Roundness, colour = interaction_SEX_TIME),
             linetype = "dashed", size =1.5, show.legend = FALSE) +
  ggtitle(paste0("<span style='color:#fa7070'> Central </span>roundness (A.U.)")) +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45, vjust = 1)) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 3),
                     breaks = seq(0, 3, by = 0.5)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0.05)), limits = c(0, 1.02),
                     breaks = seq(0.2, 1, by = 0.2)) +
  theme(plot.title = element_markdown()) +
  guides(colour = guide_legend(override.aes = list(linetype = "solid", size = 2)))

graph2doc(file="plot8.docx", width=4,height=4.5)

ggplot(TEMtracetotal %>% dplyr::filter(Location == "sM"), aes(x= Roundness,colour=interaction_SEX_TIME)) + 
  geom_density(size = 2, alpha = 5, show.legend = FALSE) +
  scale_colour_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#34d8eb",
                                  "F.PRE" = "#e3b3e0", "F.POST" = "#e887e3"),
                    name = "Group",
                    labels = c("M.PRE" ="Men PRE", "M.POST" = "Men POST",
                               "F.PRE" = "Women PRE", "F.POST" = "Women POST")) + 
  labs(x = NULL, y = "Density distribution (%)") +
  geom_vline(data = TEMtraceRoundness %>% dplyr::filter(Location == "sM"),
             aes(xintercept = mean_Roundness, colour = interaction_SEX_TIME),
             linetype = "dashed", size =1.5, show.legend = FALSE) +
  ggtitle(paste0("<span style='color:#edd068'> Superficial </span>roundness (A.U.)")) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45, vjust = 1)) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 3), 
                     breaks = seq(0, 3, by = 0.5)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0.05)), limits = c(0, 1.02), 
                     breaks = seq(0.2, 1, by = 0.2)) +
  theme(plot.title = element_markdown()) +
  guides(colour = guide_legend(override.aes = list(linetype = "solid", size = 2)))

graph2doc(file="plot9.docx", width=4,height=4.5)
```

#Sex-specific RCR pre/post training (Appendix IV - Fig 7.4.4)
```{r}
chapter4resultsfilterRCR <- chapter4results %>% 
  dplyr::filter(!is.na(CIIIP)) %>%
  dplyr::filter(ID != "P36")

chapter4resultsfilterRCR <-  chapter4resultsfilterRCR %>% group_by(ID, TIME) %>%
  mutate(RCR = CIIIP/CIL)

#make each set of data plotted in the right spot
chapter4resultsfilterRCR$TIME <- factor(chapter4resultsfilterRCR$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterRCR$interaction_SEX_TIME <- interaction(chapter4resultsfilterRCR$SEX, chapter4resultsfilterRCR$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiRCR for bars on graph
summary_statsRCR <- chapter4resultsfilterRCR %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(RCR),
            sd_value = sd(RCR, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultRCR <- aov(RCR ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterRCR)
anovaRCR <- summary(anova_resultRCR)
anovaRCR <- as.data.frame(anovaRCR$`Error: ID:TIME`[[1]])
twowaypvalueRCR <- anovaRCR["SEX:TIME", "Pr(>F)"]
print(twowaypvalueRCR)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsRCR <- emmeans(anova_resultRCR, ~ TIME | SEX)
multiplecomparisonsRCR <- summary(pairs(multiplecomparisonsRCR), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsRCR$p.value[multiplecomparisonsRCR$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsRCR$p.value[multiplecomparisonsRCR$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelRCR <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelRCR <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelRCR <- ifelse(twowaypvalueRCR <= 0.05, 
                             ifelse(twowaypvalueRCR <= 0.001, "***", 
                                    ifelse(twowaypvalueRCR <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsRCR <- max(chapter4resultsfilterRCR$RCR) * 1.5

y_positionFcomparisonRCR <- max(chapter4resultsfilterRCR$RCR[chapter4resultsfilterRCR$SEX == "F"]) * 1.2

y_positionMcomparisonRCR <- max(chapter4resultsfilterRCR$RCR[chapter4resultsfilterRCR$SEX == "M"]) * 1.2


#plot of RCR
ggplot(data=chapter4resultsfilterRCR, aes(x=interaction_SEX_TIME, y=RCR)) +
  geom_bar(data = summary_statsRCR,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsRCR,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterRCR,
            aes(x = interaction_SEX_TIME, y = RCR, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y = bquote("Respiratory control ratio (A.U.)")) +
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("Respiratory control ratio") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 50), breaks = seq(0, 50, by = 10))
```

#Correlation between changes in mitochondrial morphology and RCR (Area & form factor - Fig 4.6G & 4.6H)
```{r}
TEMtraceparticipants <- openxlsx::read.xlsx("data/Traces TEM participants fix.xlsx")
TEMtraceparticipants$TIME <- factor(TEMtraceparticipants$TIME, levels = c("PRE", "POST"))
TEMtraceparticipants$SEX <- factor(TEMtraceparticipants$SEX, levels = c("F", "M"))

TEMtraceparticipants$interaction_SEX_TIME <- interaction(TEMtraceparticipants$SEX, TEMtraceparticipants$TIME, drop = TRUE, lex.order = TRUE)

merged_data <- chapter4results %>%
  inner_join(TEMtraceparticipants, by = c("ID", "TIME","SEX"))

merged_data <- merged_data %>% 
  dplyr::filter(!is.na(CIIIP) & !is.na(CIL) & !is.na(CIIIC))

merged_data <-  merged_data %>% group_by(ID, TIME) %>%
  mutate(OXPHOS = CI + CII + CIII + CIV + CV)

merged_data <- merged_data %>%
  group_by(ID, TIME) %>%
  mutate(RCR = CIIIP/CIL)

sumsum <- merged_data %>%
  group_by(SEX, TIME, Location) %>%
  summarise(means = mean(Area),
            sds = sd(Area, na.rm=TRUE))

TEMcorrelation <- merged_data %>%
  group_by(ID, Location) %>%
  mutate(RCRcor = (((RCR[TIME == "POST"] / RCR[TIME == "PRE"]) - 1) * 100)) %>%
  mutate(SVcor = (((SV[TIME == "POST"] / SV[TIME == "PRE"]) - 1) * 100)) %>%
  mutate(CScor = (((CSACTIVE[TIME == "POST"] / CSACTIVE[TIME == "PRE"]) - 1) * 100)) %>%
  mutate(OXPHOScor = (((OXPHOS[TIME == "POST"] / OXPHOS[TIME == "PRE"]) - 1) * 100)) %>%
  mutate(TEMcor = (((Area[TIME == "POST"] / Area[TIME == "PRE"]) - 1) * 100)) %>%
  mutate(TEMcor2 = ((Perimeter[TIME == "POST"] / Perimeter[TIME == "PRE"]) - 1) * 100) %>%
  mutate(TEMcor3 = (((Roundness[TIME == "POST"] / Roundness[TIME == "PRE"]) - 1) * 100)) %>%
  mutate(TEMcor4 = ((MitoVd[TIME == "POST"] / MitoVd[TIME == "PRE"]) - 1) * 100) %>%
  mutate(CIIIPcor = ((CIIIP[TIME == "POST"] / CIIIP[TIME == "PRE"]) - 1) * 100) %>%
  mutate(CIIICcor = ((CIIIC[TIME == "POST"] / CIIIC[TIME == "PRE"]) - 1) * 100)

TEMcorrelation <- TEMcorrelation %>% dplyr::filter(TIME == "PRE")

coupledtitle <- expression(atop("Changes in the respiratory control ratio and mitochondrial area"))

ggplot(TEMcorrelation, aes(x = TEMcor, y = RCRcor, group = Location)) + 
  labs(y = expression("Change in RCR (%)"), 
       x = expression("Change in mitochondrial area (%)"), 
       fill = "Sex")  + 
  geom_vline(xintercept = 0, linetype = "dashed", colour = "black") +
  geom_hline(yintercept = 0, linetype = "dashed", colour = "black") +
  geom_smooth(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
             aes(colour = Location), method = "lm", se=FALSE, size = 2, show.legend=FALSE) +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location %in% c("sM", "SS")),
             aes(fill = SEX, colour = Location), shape = 21, size = 3, stroke = 2, show.legend=FALSE) +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
             aes(fill = SEX, colour = Location), shape = 21, size = 6, stroke = 2.5, show.legend=FALSE) +
  scale_fill_manual(values = c("M" = "#94e2eb", "F" = "#e3b3e0"), 
                    labels = c("F" = "Women", "M" = "Men")) +
  scale_colour_manual(values = c("SS" = "#8bde64", "cM" = "#fa7070", "sM" = "#edd068",
                                 "M" = "#94e2eb", "F" = "#e3b3e0"),
                      labels = c("SS" = "Subsarcolemmal", "cM" = "Central", "sM" = "Superficial")) +
  stat_cor(data = (TEMcorrelation %>% dplyr::filter(Location == "cM", SEX == "F")),
          color = "#e3b3e0", label.x = 45, label.y = 300, size = 5,
          p.accuracy = 0.001, show.legend=FALSE) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "cM", SEX == "M"), 
          color = "#94e2eb", label.x = 45, label.y = 280, size = 5, 
          p.accuracy = 0.001, show.legend=FALSE) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
           colour = "#fa7070",label.x = 45, label.y = 240, size = 5,
           p.accuracy = 0.001, show.legend=FALSE) +
  stat_cor(data = (TEMcorrelation %>% dplyr::filter(Location == "SS")),
          color = "#8bde64", label.x = 45, label.y = 220, size = 5,
          p.accuracy = 0.001, show.legend=FALSE) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "sM"),
          color = "#edd068", label.x = 45, label.y = 200, size = 5, 
          p.accuracy = 0.001, show.legend=FALSE) +
  geom_rect(xmin = 42, xmax = 113,
            ymin = 265, ymax = 315, size = 1.5,
            color = "#fa7070", alpha = 0) +
  ggtitle("Changes in the RCR and mitochondrial area") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12),
        axis.title.x = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 14)) +
  guides(fill = guide_legend(title = "Sex", override.aes = list(colour = NA, shape = c(21, 21),
                                                                fill = c("#e3b3e0", "#94e2eb"))),
         colour = guide_legend(override.aes = list(size = 5, stroke = 2.5))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(-80, 320),
                     breaks = seq(-80, 320, by = 40)) +
  scale_x_continuous(limits= c(-45, 120), breaks = seq(-40, 120, by = 20))

ggplot(TEMcorrelation, aes(x = SVcor, y = RCRcor, group = Location)) + 
  labs(y = expression("Change in RCR (%)"), 
       x = expression("Change in mitochondrial form factor (%)"), 
       fill = "Sex")  + 
  geom_vline(xintercept = 0, linetype = "dashed", colour = "black") +
  geom_hline(yintercept = 0, linetype = "dashed", colour = "black") +
  geom_smooth(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
             aes(colour = Location), method = "lm", se=FALSE, size = 2, show.legend=FALSE) +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location %in% c("sM", "SS")),
             aes(fill = SEX, colour = Location), shape = 21, size = 3, stroke = 2, show.legend=FALSE) +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
             aes(fill = SEX, colour = Location), shape = 21, size = 6, stroke = 2.5, show.legend=FALSE) +
  scale_fill_manual(values = c("M" = "#94e2eb", "F" = "#e3b3e0"), 
                    labels = c("F" = "Women", "M" = "Men")) +
  scale_colour_manual(values = c("SS" = "#8bde64", "cM" = "#fa7070", "sM" = "#edd068",
                                 "M" = "#94e2eb", "F" = "#e3b3e0"),
                      labels = c("SS" = "Subsarcolemmal", "cM" = "Central", "sM" = "Superficial")) +
  stat_cor(data = (TEMcorrelation %>% dplyr::filter(Location == "cM", SEX == "F")),
          color = "#e3b3e0", label.x = -45, label.y = 300, size = 5,
          p.accuracy = 0.001, show.legend=FALSE) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "cM", SEX == "M"), aes(color = SEX),
          label.x = -45, label.y = 280, size = 5, 
          p.accuracy = 0.001, show.legend=FALSE) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
           colour = "#fa7070",label.x = -45, label.y = 240, size = 5, 
           p.accuracy = 0.001, show.legend=FALSE) +
  stat_cor(data = (TEMcorrelation %>% dplyr::filter(Location == "SS")),
      color = "#8bde64", label.x = -45, label.y = 220, size = 5,
      p.accuracy = 0.001, show.legend=FALSE) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "sM"),
          color = "#edd068", label.x = -45, label.y = 200, size = 5,
          p.accuracy = 0.001, show.legend=FALSE) +
  geom_rect(xmin = -47, xmax = -20,
            ymin = 265, ymax = 315, size = 1.5,
            color = "#fa7070", alpha = 0) +
  ggtitle("Changes in the RCR and mitochondrial form factor") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12),
        axis.title.x = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 14)) +
  guides(fill = "none", colour = guide_legend(override.aes = list(size = 5, stroke = 2.5))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(-80, 320), breaks = seq(-80, 320, by = 40)) +
  scale_x_continuous(limits= c(-45, 20), breaks = seq(-40, 20, by = 20))
```

#Correlation between changes in mitochondrial morphology and CI+IIP and CI+IIE(Area, form factor, and roundness) (Appendix IV - Fig 7.4.5)
```{r}
ggplot(TEMcorrelation, aes(x = TEMcor3, y = CIIIPcor, group = Location)) + 
  labs(y = expression("Change in CI+II "[P]~"(%)"), 
       x = expression("Change in mitochondrial roundness (%)"), 
       fill = "Sex")  + 
  geom_vline(xintercept = 0, linetype = "dashed", colour = "black") +
  geom_hline(yintercept = 0, linetype = "dashed", colour = "black") +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location %in% c("sM", "SS")),
             aes(fill = SEX, colour = Location), shape = 21, size = 4, stroke = 2.5, show.legend = FALSE) +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
             aes(fill = SEX, colour = Location), shape = 21, size = 4, stroke = 2.5, show.legend = FALSE) +
  scale_fill_manual(values = c("M" = "#94e2eb", "F" = "#e3b3e0"), 
                    labels = c("F" = "Women", "M" = "Men")) +
  scale_colour_manual(values = c("SS" = "#8bde64", "cM" = "#fa7070", "sM" = "#edd068",
                                 "M" = "#94e2eb", "F" = "#e3b3e0"),
                      labels = c("SS" = "Subsarcolemmal", "cM" = "Central", "sM" = "Superficial")) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
           colour = "#fa7070",label.x = 40, label.y = 115, size = 5,  p.accuracy = 0.001, show.legend = FALSE) +
  stat_cor(data = (TEMcorrelation %>% dplyr::filter(Location == "SS")),
      color = "#8bde64", label.x = 40, label.y = 105, size = 5, p.accuracy = 0.001, show.legend = FALSE) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "sM"),
          color = "#edd068", label.x = 40, label.y = 95, size = 5,  p.accuracy = 0.001, show.legend = FALSE) +
  ggtitle(expression("Changes in mitochondrial roundness and CI+II"[P])) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12),
        axis.title.x = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 14),
        plot.margin = ggplot2::margin(0, 1, 0, 0, "cm")) +
  guides(fill = "none", colour = guide_legend(override.aes = list(size = 5, stroke = 2.5))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(-20, 120), breaks = seq(-20, 120, by = 20)) +
    scale_x_continuous(expand = expansion(mult = c(0, 0)), limits= c(-40, 100), breaks = seq(-40, 100, by = 20))

ggplot(TEMcorrelation, aes(x = TEMcor3, y = CIIICcor, group = Location)) + 
  labs(y = expression("Change in CI+II "[E]~"(%)"), 
       x = expression("Change in mitochondrial roundness (%)"), 
       fill = "Sex")  + 
  geom_vline(xintercept = 0, linetype = "dashed", colour = "black") +
  geom_hline(yintercept = 0, linetype = "dashed", colour = "black") +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location %in% c("sM", "SS")),
             aes(fill = SEX, colour = Location), shape = 21, size = 4, stroke = 2.5, show.legend = FALSE) +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
             aes(fill = SEX, colour = Location), shape = 21, size = 4, stroke = 2.5, show.legend = FALSE) +
  
  scale_fill_manual(values = c("M" = "#94e2eb", "F" = "#e3b3e0"), 
                    labels = c("F" = "Women", "M" = "Men")) +
  scale_colour_manual(values = c("SS" = "#8bde64", "cM" = "#fa7070", "sM" = "#edd068", "M" = "#94e2eb", "F" = "#e3b3e0"),
                      labels = c("SS" = "Subsarcolemmal", "cM" = "Central", "sM" = "Superficial")) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
           colour = "#fa7070",label.x = 40, label.y = 95, size = 5,  p.accuracy = 0.001, show.legend = FALSE) +
 stat_cor(data = (TEMcorrelation %>% dplyr::filter(Location == "SS")),
      color = "#8bde64", label.x = 40, label.y = 85, size = 5, p.accuracy = 0.001, show.legend = FALSE) +
 stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "sM"),
          color = "#edd068", label.x = 40, label.y = 75, size = 5,  p.accuracy = 0.001, show.legend = FALSE) +
  ggtitle(expression("Changes in mitochondrial roundness and CI+II"[E])) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12),
        axis.title.x = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 14),
        plot.margin = ggplot2::margin(0, 1, 0, 0, "cm")) +
  guides(fill = "none", colour = guide_legend(override.aes = list(size = 5, stroke = 2.5))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(-20, 100), breaks = seq(-20, 100, by = 20)) +
    scale_x_continuous(expand = expansion(mult = c(0, 0)), limits= c(-40, 100), breaks = seq(-40, 100, by = 20))
```

#correlation between mito area and respiration
```{r}
ggplot(TEMcorrelation, aes(x = TEMcor, y = CIIIPcor, group = Location)) + 
  labs(y = expression("Change in CI+II "[P]~"(%)"), 
       x = expression("Change in mitochondrial area (%)"), 
       fill = "Sex")  + 
  geom_vline(xintercept = 0, linetype = "dashed", colour = "black") +
  geom_hline(yintercept = 0, linetype = "dashed", colour = "black") +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location %in% c("sM", "SS")),
             aes(fill = SEX, colour = Location), shape = 21, size = 4, stroke = 2.5, show.legend = FALSE) +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
             aes(fill = SEX, colour = Location), shape = 21, size = 4, stroke = 2.5, show.legend = FALSE) +
  scale_fill_manual(values = c("M" = "#94e2eb", "F" = "#e3b3e0"), 
                    labels = c("F" = "Women", "M" = "Men")) +
  scale_colour_manual(values = c("SS" = "#8bde64", "cM" = "#fa7070", "sM" = "#edd068",
                                 "M" = "#94e2eb", "F" = "#e3b3e0"),
                      labels = c("SS" = "Subsarcolemmal", "cM" = "Central", "sM" = "Superficial")) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
           colour = "#fa7070",label.x = 75, label.y = 115, size = 5,
           p.accuracy = 0.001, show.legend = FALSE) +
  stat_cor(data = (TEMcorrelation %>% dplyr::filter(Location == "SS")),
          color = "#8bde64", label.x = 75, label.y = 105, size = 5,
          p.accuracy = 0.001, show.legend = FALSE) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "sM"),
          color = "#edd068", label.x = 75, label.y = 95, size = 5,
          p.accuracy = 0.001, show.legend = FALSE) +
  ggtitle(expression("Changes in mitochondrial area and CI+II"[P])) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12),
        axis.title.x = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 14),
        plot.margin = ggplot2::margin(0, 1, 0, 0, "cm")) +
  guides(fill = "none", colour = guide_legend(override.aes = list(size = 5, stroke = 2.5))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(-20, 120), breaks = seq(-20, 120, by = 20)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0)), limits= c(-40, 140), breaks = seq(-40, 140, by = 20))

ggplot(TEMcorrelation, aes(x = TEMcor, y = CIIICcor, group = Location)) + 
  labs(y = expression("Change in CI+II "[E]~"(%)"), 
       x = expression("Change in mitochondrial area (%)"), 
       fill = "Sex")  + 
  geom_vline(xintercept = 0, linetype = "dashed", colour = "black") +
  geom_hline(yintercept = 0, linetype = "dashed", colour = "black") +
  geom_smooth(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
             aes(colour = Location), method = "lm", se=FALSE, size = 2, show.legend = FALSE) +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location %in% c("sM", "SS")),
             aes(fill = SEX, colour = Location), shape = 21, size = 3, stroke = 2, show.legend = FALSE) +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
             aes(fill = SEX, colour = Location), shape = 21, size = 6, stroke = 2.5, show.legend = FALSE) +
  scale_fill_manual(values = c("M" = "#94e2eb", "F" = "#e3b3e0"), 
                    labels = c("F" = "Women", "M" = "Men")) +
  scale_colour_manual(values = c("SS" = "#8bde64", "cM" = "#fa7070", "sM" = "#edd068",
                                 "M" = "#94e2eb", "F" = "#e3b3e0"),
                      labels = c("SS" = "Subsarcolemmal", "cM" = "Central", "sM" = "Superficial")) +
  stat_cor(data = (TEMcorrelation %>% dplyr::filter(Location == "cM", SEX == "F")),
          color = "#e3b3e0", label.x = 75, label.y = 115, size = 5,
          p.accuracy = 0.001, show.legend = FALSE) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "cM", SEX == "M"), aes(color = SEX),
          label.x = 75, label.y = 105, size = 5,
          p.accuracy = 0.001, show.legend = FALSE) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
          colour = "#fa7070",label.x = 75, label.y = 95, size = 5,
          p.accuracy = 0.001, show.legend = FALSE) +
  stat_cor(data = (TEMcorrelation %>% dplyr::filter(Location == "SS")),
          color = "#8bde64", label.x = 75, label.y = 85, size = 5,
          p.accuracy = 0.001, show.legend = FALSE) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "sM"),
          color = "#edd068", label.x = 75, label.y = 75, size = 5,
          p.accuracy = 0.001, show.legend = FALSE) +
  geom_rect(xmin = 72, xmax = 141,
            ymin = 120, ymax = 100, size = 1.5,
            color = "#fa7070", alpha = 0) +
  ggtitle(expression("Changes in mitochondrial area and CI+II"[E])) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12),
        axis.title.x = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 14),
        plot.margin = ggplot2::margin(0, 1, 0, 0, "cm")) +
  guides(fill = "none", colour = guide_legend(override.aes = list(size = 5, stroke = 2.5))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(-20, 122), breaks = seq(-20, 120, by = 20)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0)), limits= c(-40, 142), breaks = seq(-40, 140, by = 20))

ggplot(TEMcorrelation, aes(x = SVcor, y = CIIIPcor, group = Location)) + 
  labs(y = expression("Change in CI+II "[P]~"(%)"), 
       x = expression("Change in mitochondrial form factor (%)"), 
       fill = "Sex")  + 
  geom_vline(xintercept = 0, linetype = "dashed", colour = "black") +
  geom_hline(yintercept = 0, linetype = "dashed", colour = "black") +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location %in% c("sM", "SS", "cM")),
             aes(fill = SEX, colour = Location), shape = 21, size = 4, stroke = 2.5, show.legend = FALSE) +
  scale_fill_manual(values = c("M" = "#94e2eb", "F" = "#e3b3e0"), 
                    labels = c("F" = "Women", "M" = "Men")) +
  scale_colour_manual(values = c("SS" = "#8bde64", "cM" = "#fa7070", "sM" = "#edd068",
                                 "M" = "#94e2eb", "F" = "#e3b3e0"),
                      labels = c("SS" = "Subsarcolemmal", "cM" = "Central", "sM" = "Superficial")) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
           colour = "#fa7070",label.x = -5, label.y = 115, size = 5,
           p.accuracy = 0.001, show.legend = FALSE) +
  stat_cor(data = (TEMcorrelation %>% dplyr::filter(Location == "SS")),
          color = "#8bde64", label.x = -5, label.y = 105, size = 5,
          p.accuracy = 0.001, show.legend = FALSE) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "sM"),
          color = "#edd068", label.x = -5, label.y = 95, size = 5,
          p.accuracy = 0.001, show.legend = FALSE) +
  ggtitle(expression("Changes in mitochondrial form factor and CI+II"[P])) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12),
        axis.title.x = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 14),
        plot.margin = ggplot2::margin(0, 1, 0, 0, "cm")) +
  guides(fill = "none", colour = guide_legend(override.aes = list(size = 5, stroke = 2.5))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(-25, 120), breaks = seq(-20, 120, by = 20)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0)), limits= c(-50, 25), breaks = seq(-50, 25, by = 25))

ggplot(TEMcorrelation, aes(x = SVcor, y = CIIICcor, group = Location)) + 
  labs(y = expression("Change in CI+II "[E]~"(%)"), 
       x = expression("Change in mitochondrial form factor (%)"), 
       fill = "Sex")  + 
  geom_vline(xintercept = 0, linetype = "dashed", colour = "black") +
  geom_hline(yintercept = 0, linetype = "dashed", colour = "black") +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location %in% c("sM", "SS")),
             aes(fill = SEX, colour = Location), shape = 21, size = 4, stroke = 2.5, show.legend = FALSE) +
  geom_point(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
             aes(fill = SEX, colour = Location), shape = 21, size = 4, stroke = 2.5, show.legend = FALSE) +
  scale_fill_manual(values = c("M" = "#94e2eb", "F" = "#e3b3e0"), 
                    labels = c("F" = "Women", "M" = "Men")) +
  scale_colour_manual(values = c("SS" = "#8bde64", "cM" = "#fa7070", "sM" = "#edd068",
                                 "M" = "#94e2eb", "F" = "#e3b3e0"),
                      labels = c("SS" = "Subsarcolemmal", "cM" = "Central", "sM" = "Superficial")) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "cM"),
           colour = "#fa7070",label.x = -5, label.y = 95, size = 5, 
           p.accuracy = 0.001, show.legend = FALSE) +
  stat_cor(data = (TEMcorrelation %>% dplyr::filter(Location == "SS")),
          color = "#8bde64", label.x = -5, label.y = 85, size = 5,
          p.accuracy = 0.001, show.legend = FALSE) +
  stat_cor(data = TEMcorrelation %>% dplyr::filter(Location == "sM"),
          color = "#edd068", label.x = -5, label.y = 75, size = 5,
          p.accuracy = 0.001, show.legend = FALSE) +
  geom_rect(xmin = 72, xmax = 140,
              ymin = 120, ymax = 100, size = 1.5,
              color = "#fa7070", alpha = 0) +
  ggtitle(expression("Changes in mitochondrial form factor and CI+II"[E])) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12),
        axis.title.x = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 14),
        plot.margin = ggplot2::margin(0, 1, 0, 0, "cm")) +
  guides(fill = "none", colour = guide_legend(override.aes = list(size = 5, stroke = 2.5))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(-25, 100), breaks = seq(-20, 100, by = 20)) +
  scale_x_continuous(expand = expansion(mult = c(0, 0)), limits= c(-50, 25), breaks = seq(-50, 25, by = 25))
```


#BN-PAGE protein content results (Fig 4.7A)
```{r}
chapter4resultsfilterRESPIRASOME <- chapter4results %>% 
  dplyr::filter(!is.na(BNCI) & !is.na(BNCIII) & !is.na(BNCIV))

chapter4resultsfilterRESPIRASOME <-  chapter4resultsfilterRESPIRASOME %>% group_by(ID, TIME) %>%
  mutate(RESPIRASOME = (BNCI + BNCIII + BNCIV))

#make each set of data plotted in the right spot
chapter4resultsfilterRESPIRASOME$TIME <- factor(chapter4resultsfilterRESPIRASOME$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterRESPIRASOME$interaction_SEX_TIME <- interaction(chapter4resultsfilterRESPIRASOME$SEX, chapter4resultsfilterRESPIRASOME$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiRESPIRASOME for bars on graph
summary_statsRESPIRASOME <- chapter4resultsfilterRESPIRASOME %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(RESPIRASOME),
            sd_value = sd(RESPIRASOME, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultRESPIRASOME <- aov(RESPIRASOME ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterRESPIRASOME)
anovaRESPIRASOME <- summary(anova_resultRESPIRASOME)
anovaRESPIRASOME <- as.data.frame(anovaRESPIRASOME$`Error: ID:TIME`[[1]])
twowaypvalueRESPIRASOME <- anovaRESPIRASOME["SEX:TIME", "Pr(>F)"]
print(twowaypvalueRESPIRASOME)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsRESPIRASOME <- emmeans(anova_resultRESPIRASOME, ~ TIME | SEX)
multiplecomparisonsRESPIRASOME <- summary(pairs(multiplecomparisonsRESPIRASOME), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsRESPIRASOME$p.value[multiplecomparisonsRESPIRASOME$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsRESPIRASOME$p.value[multiplecomparisonsRESPIRASOME$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelRESPIRASOME <- round(Mmultiplecomparisons, 3)

Fcomparesignificance_levelRESPIRASOME <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelRESPIRASOME <- ifelse(twowaypvalueRESPIRASOME <= 0.05, 
                             ifelse(twowaypvalueRESPIRASOME <= 0.001, "***", 
                                    ifelse(twowaypvalueRESPIRASOME <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsRESPIRASOME <- max(chapter4resultsfilterRESPIRASOME$RESPIRASOME) * 1.5

y_positionFcomparisonRESPIRASOME <- max(chapter4resultsfilterRESPIRASOME$RESPIRASOME[chapter4resultsfilterRESPIRASOME$SEX == "F"]) * 1.2

y_positionMcomparisonRESPIRASOME <- max(chapter4resultsfilterRESPIRASOME$RESPIRASOME[chapter4resultsfilterRESPIRASOME$SEX == "M"]) * 1.2


#plot of RESPIRASOME
ggplot(data=chapter4resultsfilterRESPIRASOME, aes(x=interaction_SEX_TIME, y=RESPIRASOME)) + geom_bar(data = summary_statsRESPIRASOME,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb", "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
    geom_errorbar(data = summary_statsRESPIRASOME,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value), inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterRESPIRASOME,
            aes(x = interaction_SEX_TIME, y = RESPIRASOME, fill = interaction_SEX_TIME), height = 0, width = 0.175,
      
             size = 3,
            shape = 21,
             colour = "black", alpha = 1.0,
            stroke = 1.5,
             show.legend = FALSE) + 
labs(y = bquote("Total respirasome protein content (A.U.)"))+   scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("Total respirasome protein content") +
  theme_classic() +
    theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 10), breaks = seq(0, 10, by = 2)) +
    geom_signif(
              y_position = y_positionFcomparisonRESPIRASOME, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelRESPIRASOME, tip_length = 0, family = "sans", size=1, textsize=8) +
   geom_signif(
    y_position = y_positionMcomparisonRESPIRASOME, xmin = c(3), xmax = c(4),
   annotation = Mcomparesignificance_levelRESPIRASOME, tip_length = 0, family = "sans", size=1, textsize=6)


chapter4resultsfilterTOTALFREE <- chapter4results %>% 
  filter(!is.na(BNCI) & !is.na(BNCIII) & !is.na(BNCIV))

chapter4resultsfilterTOTALFREE <-  chapter4resultsfilterTOTALFREE %>% group_by(ID, TIME) %>%
  mutate(TOTALFREE = FREECI + FREECIII + FREECIV)

#make each set of data plotted in the right spot
chapter4resultsfilterTOTALFREE$TIME <- factor(chapter4resultsfilterTOTALFREE$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterTOTALFREE$interaction_SEX_TIME <- interaction(chapter4resultsfilterTOTALFREE$SEX, chapter4resultsfilterTOTALFREE$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiTOTALFREE for bars on graph
summary_statsTOTALFREE <- chapter4resultsfilterTOTALFREE %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(TOTALFREE),
            sd_value = sd(TOTALFREE, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultTOTALFREE <- aov(TOTALFREE ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterTOTALFREE)
anovaTOTALFREE <- summary(anova_resultTOTALFREE)
anovaTOTALFREE <- as.data.frame(anovaTOTALFREE$`Error: ID:TIME`[[1]])
twowaypvalueTOTALFREE <- anovaTOTALFREE["SEX:TIME", "Pr(>F)"]
print(twowaypvalueTOTALFREE)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsTOTALFREE <- emmeans(anova_resultTOTALFREE, ~ TIME | SEX)
multiplecomparisonsTOTALFREE <- summary(pairs(multiplecomparisonsTOTALFREE), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsTOTALFREE$p.value[multiplecomparisonsTOTALFREE$SEX == "F"]

Mmultiplecomparisons <- multiplecomparisonsTOTALFREE$p.value[multiplecomparisonsTOTALFREE$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelTOTALFREE <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelTOTALFREE <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelTOTALFREE <- ifelse(twowaypvalueTOTALFREE <= 0.05, 
                             ifelse(twowaypvalueTOTALFREE <= 0.001, "***", 
                                    ifelse(twowaypvalueTOTALFREE <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsTOTALFREE <- max(chapter4resultsfilterTOTALFREE$TOTALFREE) * 1.5

y_positionFcomparisonTOTALFREE <- max(chapter4resultsfilterTOTALFREE$TOTALFREE[chapter4resultsfilterTOTALFREE$SEX == "F"]) * 1.2

y_positionMcomparisonTOTALFREE <- max(chapter4resultsfilterTOTALFREE$TOTALFREE[chapter4resultsfilterTOTALFREE$SEX == "M"]) * 1.2

y_positionanovaTOTALFREE <- max(chapter4resultsfilterTOTALFREE$TOTALFREE) * 1.5

CIIICIV2title <- expression(paste("Normalised CIII"[2]*"+CIV content (α-COXIV)"))

#plot of TOTALFREE
ggplot(data=chapter4resultsfilterTOTALFREE, aes(x=interaction_SEX_TIME, y=TOTALFREE)) +
  geom_bar(data = summary_statsTOTALFREE,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsTOTALFREE,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterTOTALFREE,
            aes(x = interaction_SEX_TIME, y = TOTALFREE, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression("Free complex protein content (A.U.)")) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("Free complex protein content") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 10), breaks = seq(0, 10, by = 2)) +
  geom_signif(
              y_position = y_positionFcomparisonTOTALFREE, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelTOTALFREE,
              tip_length = 0, family = "sans", size=1, textsize=8) +
   geom_signif(
              y_position = y_positionMcomparisonTOTALFREE, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelTOTALFREE,
              tip_length = 0, family = "sans", size=1, textsize=8)


chapter4resultsfilterCIIICIVBN <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(CIIICIVBN)) | 
         !(any(TIME == "POST") & any(is.na(CIIICIVBN))))

#make each set of data plotted in the right spot
chapter4resultsfilterCIIICIVBN$TIME <- factor(chapter4resultsfilterCIIICIVBN$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIIICIVBN$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIIICIVBN$SEX, chapter4resultsfilterCIIICIVBN$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiCIIICIVBN for bars on graph
summary_statsCIIICIVBN <- chapter4resultsfilterCIIICIVBN %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIIICIVBN),
            sd_value = sd(CIIICIVBN, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIIICIVBN <- aov(CIIICIVBN ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIIICIVBN)
anovaCIIICIVBN <- summary(anova_resultCIIICIVBN)
anovaCIIICIVBN <- as.data.frame(anovaCIIICIVBN$`Error: ID:TIME`[[1]])
twowaypvalueCIIICIVBN <- anovaCIIICIVBN["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIIICIVBN)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIIICIVBN <- emmeans(anova_resultCIIICIVBN, ~ TIME | SEX)
multiplecomparisonsCIIICIVBN <- summary(pairs(multiplecomparisonsCIIICIVBN), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIIICIVBN$p.value[multiplecomparisonsCIIICIVBN$SEX == "F"]

Mmultiplecomparisons <- multiplecomparisonsCIIICIVBN$p.value[multiplecomparisonsCIIICIVBN$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIIICIVBN <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelCIIICIVBN <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCIIICIVBN <- ifelse(twowaypvalueCIIICIVBN <= 0.05, 
                             ifelse(twowaypvalueCIIICIVBN <= 0.001, "***", 
                                    ifelse(twowaypvalueCIIICIVBN <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIIICIVBN <- max(chapter4resultsfilterCIIICIVBN$CIIICIVBN) * 1.5

y_positionFcomparisonCIIICIVBN <- max(chapter4resultsfilterCIIICIVBN$CIIICIVBN[chapter4resultsfilterCIIICIVBN$SEX == "F"]) * 1.2

y_positionMcomparisonCIIICIVBN <- max(chapter4resultsfilterCIIICIVBN$CIIICIVBN[chapter4resultsfilterCIIICIVBN$SEX == "M"]) * 1.2

y_positionanovaCIIICIVBN <- max(chapter4resultsfilterCIIICIVBN$CIIICIVBN) * 1.5

CIIICIV2title <- expression(paste("CIII"[2]*"+CIV content (α-COXIV)"))

#plot of CIIICIVBN
ggplot(data=chapter4resultsfilterCIIICIVBN, aes(x=interaction_SEX_TIME, y=CIIICIVBN)) +
  geom_bar(data = summary_statsCIIICIVBN,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCIIICIVBN,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIIICIVBN,
            aes(x = interaction_SEX_TIME, y = CIIICIVBN, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression("CIII "[2]*"+CIV protein content (A.U.)")) +   
       scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIIICIV2title) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 5), breaks = seq(0, 5, by = 0.5)) +
  geom_signif(
              y_position = y_positionFcomparisonCIIICIVBN, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelCIIICIVBN,
              tip_length = 0, family = "sans", size=1, textsize=8) +
   geom_signif(
              y_position = y_positionMcomparisonCIIICIVBN, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelCIIICIVBN,
              tip_length = 0, family = "sans", size=1, textsize=8)

chapter4resultsfilterCIV2BN <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(CIV2BN)) | 
         !(any(TIME == "POST") & any(is.na(CIV2BN))))

#make each set of data plotted in the right spot
chapter4resultsfilterCIV2BN$TIME <- factor(chapter4resultsfilterCIV2BN$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIV2BN$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIV2BN$SEX, chapter4resultsfilterCIV2BN$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiCIV2BN for bars on graph
summary_statsCIV2BN <- chapter4resultsfilterCIV2BN %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIV2BN),
            sd_value = sd(CIV2BN, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIV2BN <- aov(CIV2BN ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIV2BN)
anovaCIV2BN <- summary(anova_resultCIV2BN)
anovaCIV2BN <- as.data.frame(anovaCIV2BN$`Error: ID:TIME`[[1]])
twowaypvalueCIV2BN <- anovaCIV2BN["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIV2BN)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIV2BN <- emmeans(anova_resultCIV2BN, ~ TIME | SEX)
multiplecomparisonsCIV2BN <- summary(pairs(multiplecomparisonsCIV2BN), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIV2BN$p.value[multiplecomparisonsCIV2BN$SEX == "F"]

Mmultiplecomparisons <- multiplecomparisonsCIV2BN$p.value[multiplecomparisonsCIV2BN$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIV2BN <- round(Mmultiplecomparisons, 3)

Fcomparesignificance_levelCIV2BN <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelCIV2BN <- ifelse(twowaypvalueCIV2BN <= 0.05, 
                             ifelse(twowaypvalueCIV2BN <= 0.001, "***", 
                                    ifelse(twowaypvalueCIV2BN <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIV2BN <- max(chapter4resultsfilterCIV2BN$CIV2BN) * 1.5

y_positionFcomparisonCIV2BN <- max(chapter4resultsfilterCIV2BN$CIV2BN[chapter4resultsfilterCIV2BN$SEX == "F"]) * 1.2

y_positionMcomparisonCIV2BN <- max(chapter4resultsfilterCIV2BN$CIV2BN[chapter4resultsfilterCIV2BN$SEX == "M"]) * 1.2

y_positionanovaCIV2BN <- max(chapter4resultsfilterCIV2BN$CIV2BN) * 1.5

CIIICIV2title <- expression(paste("CIV"[2]*" content"))

#plot of CIV2BN
ggplot(data=chapter4resultsfilterCIV2BN, aes(x=interaction_SEX_TIME, y=CIV2BN)) +
  geom_bar(data = summary_statsCIV2BN,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCIV2BN,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIV2BN,
            aes(x = interaction_SEX_TIME, y = CIV2BN, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression("CIV "[2]*" protein content (A.U.)")) +   
       scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIIICIV2title) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 6), breaks = seq(0, 6, by = 1)) +
  geom_signif(
              y_position = y_positionFcomparisonCIV2BN, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelCIV2BN,
              tip_length = 0, family = "sans", size=1, textsize=8) +
   geom_signif(
              y_position = y_positionMcomparisonCIV2BN, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelCIV2BN,
              tip_length = 0, family = "sans", size=1, textsize=6)
```

#BN-PAGE protein content results normalised by SDS-PAGE (Fig 4.7B)
```{r}
chapter4resultsfilterRESPIRASOMEWB <- chapter4results %>% 
  dplyr::filter(!is.na(BNCI) & !is.na(BNCIII) & !is.na(BNCIV))

chapter4resultsfilterRESPIRASOMEWB <-  chapter4resultsfilterRESPIRASOMEWB %>% group_by(ID, TIME) %>%
  mutate(RESPIRASOMEWB = ((BNCISDS + BNCIIISDS + BNCIVSDS)))

#make each set of data plotted in the right spot
chapter4resultsfilterRESPIRASOMEWB$TIME <- factor(chapter4resultsfilterRESPIRASOMEWB$TIME,
                                                  levels = c("PRE", "POST"))
chapter4resultsfilterRESPIRASOMEWB$interaction_SEX_TIME <- interaction(chapter4resultsfilterRESPIRASOMEWB$SEX, chapter4resultsfilterRESPIRASOMEWB$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiRESPIRASOMEWB for bars on graph
summary_statsRESPIRASOMEWB <- chapter4resultsfilterRESPIRASOMEWB %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(RESPIRASOMEWB),
            sd_value = sd(RESPIRASOMEWB, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultRESPIRASOMEWB <- aov(RESPIRASOMEWB ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterRESPIRASOMEWB)
anovaRESPIRASOMEWB <- summary(anova_resultRESPIRASOMEWB)
anovaRESPIRASOMEWB <- as.data.frame(anovaRESPIRASOMEWB$`Error: ID:TIME`[[1]])
twowaypvalueRESPIRASOMEWB <- anovaRESPIRASOMEWB["SEX:TIME", "Pr(>F)"]
print(twowaypvalueRESPIRASOMEWB)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsRESPIRASOMEWB <- emmeans(anova_resultRESPIRASOMEWB, ~ TIME | SEX)
multiplecomparisonsRESPIRASOMEWB <- summary(pairs(multiplecomparisonsRESPIRASOMEWB), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsRESPIRASOMEWB$p.value[multiplecomparisonsRESPIRASOMEWB$SEX == "F"]
Mmultiplecomparisons <- multiplecomparisonsRESPIRASOMEWB$p.value[multiplecomparisonsRESPIRASOMEWB$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelRESPIRASOMEWB <- round(Mmultiplecomparisons, 3)

Fcomparesignificance_levelRESPIRASOMEWB <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelRESPIRASOMEWB <- ifelse(twowaypvalueRESPIRASOMEWB <= 0.05, 
                             ifelse(twowaypvalueRESPIRASOMEWB <= 0.001, "***", 
                                    ifelse(twowaypvalueRESPIRASOMEWB <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsRESPIRASOMEWB <- max(chapter4resultsfilterRESPIRASOMEWB$RESPIRASOMEWB) * 1.5

y_positionFcomparisonRESPIRASOMEWB <- max(chapter4resultsfilterRESPIRASOMEWB$RESPIRASOMEWB[chapter4resultsfilterRESPIRASOMEWB$SEX == "F"]) * 1.2

y_positionMcomparisonRESPIRASOMEWB <- max(chapter4resultsfilterRESPIRASOMEWB$RESPIRASOMEWB[chapter4resultsfilterRESPIRASOMEWB$SEX == "M"]) * 1.2


#plot of RESPIRASOMEWB
ggplot(data=chapter4resultsfilterRESPIRASOMEWB, aes(x=interaction_SEX_TIME, y=RESPIRASOMEWB)) +
  geom_bar(data = summary_statsRESPIRASOMEWB,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsRESPIRASOMEWB,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterRESPIRASOMEWB,
            aes(x = interaction_SEX_TIME, y = RESPIRASOMEWB, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y = bquote("Normalised respirasome protein content (A.U.)")) +
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("Normalised respirasome protein content") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 10, breaks = seq(0, 10, by = 0.5)))

chapter4resultsfilterTOTALFREESDS <- chapter4results %>% 
  filter(!is.na(BNCI) & !is.na(BNCIII) & !is.na(BNCIV))

chapter4resultsfilterTOTALFREESDS <-  chapter4resultsfilterTOTALFREESDS %>% group_by(ID, TIME) %>%
  mutate(TOTALFREESDS = FREECISDS + FREECIIISDS + FREECIVSDS)

#make each set of data plotted in the right spot
chapter4resultsfilterTOTALFREESDS$TIME <- factor(chapter4resultsfilterTOTALFREESDS$TIME,
                                                 levels = c("PRE", "POST"))
chapter4resultsfilterTOTALFREESDS$interaction_SEX_TIME <- interaction(chapter4resultsfilterTOTALFREESDS$SEX, chapter4resultsfilterTOTALFREESDS$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistiTOTALFREESDS for bars on graph
summary_statsTOTALFREESDS <- chapter4resultsfilterTOTALFREESDS %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(TOTALFREESDS),
            sd_value = sd(TOTALFREESDS, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultTOTALFREESDS <- aov(TOTALFREESDS ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterTOTALFREESDS)
anovaTOTALFREESDS <- summary(anova_resultTOTALFREESDS)
anovaTOTALFREESDS <- as.data.frame(anovaTOTALFREESDS$`Error: ID:TIME`[[1]])
twowaypvalueTOTALFREESDS <- anovaTOTALFREESDS["SEX:TIME", "Pr(>F)"]
print(twowaypvalueTOTALFREESDS)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsTOTALFREESDS <- emmeans(anova_resultTOTALFREESDS, ~ TIME | SEX)
multiplecomparisonsTOTALFREESDS <- summary(pairs(multiplecomparisonsTOTALFREESDS), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsTOTALFREESDS$p.value[multiplecomparisonsTOTALFREESDS$SEX == "F"]

Mmultiplecomparisons <- multiplecomparisonsTOTALFREESDS$p.value[multiplecomparisonsTOTALFREESDS$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelTOTALFREESDS <- ifelse(Mmultiplecomparisons <= 0.05, 
                             ifelse(Mmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Mmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

Fcomparesignificance_levelTOTALFREESDS <- ifelse(Fmultiplecomparisons <= 0.05, 
                             ifelse(Fmultiplecomparisons <= 0.001, "***", 
                                    ifelse(Fmultiplecomparisons <= 0.01, "**", "*")),
                             "ns")

anovasignificance_levelTOTALFREESDS <- ifelse(twowaypvalueTOTALFREESDS <= 0.05, 
                             ifelse(twowaypvalueTOTALFREESDS <= 0.001, "***", 
                                    ifelse(twowaypvalueTOTALFREESDS <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsTOTALFREESDS <- max(chapter4resultsfilterTOTALFREESDS$TOTALFREESDS) * 1.5

y_positionFcomparisonTOTALFREESDS <- max(chapter4resultsfilterTOTALFREESDS$TOTALFREESDS[chapter4resultsfilterTOTALFREESDS$SEX == "F"]) * 1.2

y_positionMcomparisonTOTALFREESDS <- max(chapter4resultsfilterTOTALFREESDS$TOTALFREESDS[chapter4resultsfilterTOTALFREESDS$SEX == "M"]) * 1.2

y_positionanovaTOTALFREESDS <- max(chapter4resultsfilterTOTALFREESDS$TOTALFREESDS) * 1.5

#plot of TOTALFREESDS
ggplot(data=chapter4resultsfilterTOTALFREESDS, aes(x=interaction_SEX_TIME, y=TOTALFREESDS)) +
  geom_bar(data = summary_statsTOTALFREESDS,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsTOTALFREESDS,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterTOTALFREESDS,
            aes(x = interaction_SEX_TIME, y = TOTALFREESDS, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression("Free complex protein content (A.U.)")) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle("Normalised free complex content") +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 20),breaks = seq(0, 20, by = 2))

chapter4resultsfilterCIIICIVBNSDS <- chapter4results %>%
  group_by(ID) %>%
  dplyr::filter(all(c("PRE", "POST") %in% TIME & !is.na(CIIICIVBNSDS)) | 
         !(any(TIME == "POST") & any(is.na(CIIICIVBNSDS))))

#make each set of data plotted in the right spot
chapter4resultsfilterCIIICIVBNSDS$TIME <- factor(chapter4resultsfilterCIIICIVBNSDS$TIME, levels = c("PRE", "POST"))
chapter4resultsfilterCIIICIVBNSDS$interaction_SEX_TIME <- interaction(chapter4resultsfilterCIIICIVBNSDS$SEX, chapter4resultsfilterCIIICIVBNSDS$TIME, drop = TRUE, lex.order = TRUE)

#get summary statistics for bars on graph
summary_statsCIIICIVBNSDS <- chapter4resultsfilterCIIICIVBNSDS %>%
  group_by(interaction_SEX_TIME) %>%
  summarise(mean_value = mean(CIIICIVBNSDS),
            sd_value = sd(CIIICIVBNSDS, na.rm = TRUE))

# Performing two-way ANOVA
anova_resultCIIICIVBNSDS <- aov(CIIICIVBNSDS ~ SEX * TIME + Error(ID/TIME), data = chapter4resultsfilterCIIICIVBNSDS)
anovaCIIICIVBNSDS <- summary(anova_resultCIIICIVBNSDS)
anovaCIIICIVBNSDS <- as.data.frame(anovaCIIICIVBNSDS$`Error: ID:TIME`[[1]])
twowaypvalueCIIICIVBNSDS <- anovaCIIICIVBNSDS["SEX:TIME", "Pr(>F)"]
print(twowaypvalueCIIICIVBNSDS)

#multiple comparisons from two-way ANOVA (BH USED-adjust if needed)
multiplecomparisonsCIIICIVBNSDS <- emmeans(anova_resultCIIICIVBNSDS, ~ TIME | SEX)
multiplecomparisonsCIIICIVBNSDS <- summary(pairs(multiplecomparisonsCIIICIVBNSDS), by = NULL, adjust = "holm")

Fmultiplecomparisons <- multiplecomparisonsCIIICIVBNSDS$p.value[multiplecomparisonsCIIICIVBNSDS$SEX == "F"]

Mmultiplecomparisons <- multiplecomparisonsCIIICIVBNSDS$p.value[multiplecomparisonsCIIICIVBNSDS$SEX == "M"]

# mapping significance level as a *
significance_levels <- c("***" = 0.001, "**" = 0.01, "*" = 0.05)
Mcomparesignificance_levelCIIICIVBNSDS <- round(Mmultiplecomparisons,3)

Fcomparesignificance_levelCIIICIVBNSDS <- round(Fmultiplecomparisons,3)

anovasignificance_levelCIIICIVBNSDS <- ifelse(twowaypvalueCIIICIVBNSDS <= 0.05, 
                             ifelse(twowaypvalueCIIICIVBNSDS <= 0.001, "***", 
                                    ifelse(twowaypvalueCIIICIVBNSDS <= 0.01, "**", "*")),
                             "ns")

#personalised positioning of significance bars and graphing elements for each measurement (just makes it easier and consistent)

limitsCIIICIVBNSDS <- max(chapter4resultsfilterCIIICIVBNSDS$CIIICIVBNSDS) * 1.5

y_positionFcomparisonCIIICIVBNSDS <- max(chapter4resultsfilterCIIICIVBNSDS$CIIICIVBNSDS[chapter4resultsfilterCIIICIVBNSDS$SEX == "F"]) * 1.2

y_positionMcomparisonCIIICIVBNSDS <- max(chapter4resultsfilterCIIICIVBNSDS$CIIICIVBNSDS[chapter4resultsfilterCIIICIVBNSDS$SEX == "M"]) * 1.2

y_positionanovaCIIICIVBNSDS <- max(chapter4resultsfilterCIIICIVBNSDS$CIIICIVBNSDS) * 1.5

CIIICIV2title <- expression(paste("Normalised CIII"[2]*"+CIV content (α-COXIV)"))

#plot of CIIICIVBNSDS
ggplot(data=chapter4resultsfilterCIIICIVBNSDS, aes(x=interaction_SEX_TIME, y=CIIICIVBNSDS)) +
  geom_bar(data = summary_statsCIIICIVBNSDS,
           aes(x=interaction_SEX_TIME, y = mean_value, fill = interaction_SEX_TIME),
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.5,
           linewidth = 1,
           show.legend = FALSE) + 
  scale_fill_manual(values = c("M.PRE" = "#94e2eb", "M.POST" = "#94e2eb",
                               "F.PRE" = "#e3b3e0", "F.POST" = "#e3b3e0"),
                    name = "Sex",
                    labels = c("Women", "Men")) +
  geom_errorbar(data = summary_statsCIIICIVBNSDS,
           aes(x=interaction_SEX_TIME, ymin = mean_value - sd_value, ymax = mean_value + sd_value),
           inherit.aes = FALSE,
           stat = "identity",
           position = "identity",
           color = "black",
           width = 0.33,
           size = 1) +
  geom_jitter(data = chapter4resultsfilterCIIICIVBNSDS,
            aes(x = interaction_SEX_TIME, y = CIIICIVBNSDS, fill = interaction_SEX_TIME),
            height = 0, width = 0.175,
            size = 3,
            shape = 21,
            colour = "black", alpha = 1.0,
            stroke = 1.5,
            show.legend = FALSE) + 
  labs(y =expression("Normalised CIII "[2]*"+CIV protein content (A.U.)")) +   
  scale_x_discrete(labels = c("F.PRE" = "PRE", "F.POST" = "POST", "M.PRE"= "PRE", "M.POST" = "POST")) +
  ggtitle(CIIICIV2title) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,),
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 16, hjust=0.45),
        axis.title.x = element_blank()) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(0, 5), breaks = seq(0, 5, by = 0.5)) +
  geom_signif(
              y_position = y_positionFcomparisonCIIICIVBNSDS, xmin = c(1), xmax = (2),
              annotation = Fcomparesignificance_levelCIIICIVBNSDS,
              tip_length = 0, family = "sans", size=1, textsize=6) +
  geom_signif(
              y_position = y_positionMcomparisonCIIICIVBNSDS, xmin = c(3), xmax = c(4),
              annotation = Mcomparesignificance_levelCIIICIVBNSDS,
              tip_length = 0, family = "sans", size=1, textsize=6)
```

#Correlation between mRNA and protein content changes (Fig 4.8A & 4.8C - OXPHOS) - requires chunks 1-3 of Chapter 3 code
```{r}
genefeatures <- function(WB, genename, rowsrna) {
  all_genes <- c(genename)
  desired_order <- c(5, 2, 4, 7, 6, 3, 8, 9, 1)
 
   
  # Initialize a data frame to store features for each gene
  features <- data.frame(gene = character(length(all_genes)),
                         correlation_peakfcup_feature = numeric(length(all_genes)),
                         pvalue_peakfcup_feature = numeric(length(all_genes)),
                         correlation_peakfcdown_feature = numeric(length(all_genes)),
                         pvalue_peakfcdown_feature = numeric(length(all_genes)),
                         correlation_avgfc_feature = numeric(length(all_genes)),
                         pvalue_avgfc_feature = numeric(length(all_genes)),
                         correlation_genestdev_feature = numeric(length(all_genes)),
                         pvalue_genestdev_feature = numeric(length(all_genes)),
                         correlation_auc_feature = numeric(length(all_genes)),
                         pvalue_auc_feature = numeric(length(all_genes)),
                         correlation_tMID_feature = numeric(length(all_genes)),
                          pvalue_tMID_feature = numeric(length(all_genes)),
                         correlation_t0_feature = numeric(length(all_genes)),
                          pvalue_t0_feature = numeric(length(all_genes)),
                          correlation_t3_feature = numeric(length(all_genes)),
                          pvalue_t3_feature = numeric(length(all_genes)),
                          correlation_t6_feature = numeric(length(all_genes)),
                          pvalue_t6_feature = numeric(length(all_genes)),
                          correlation_t9_feature = numeric(length(all_genes)),
                          pvalue_t9_feature = numeric(length(all_genes)),
                          correlation_t12_feature = numeric(length(all_genes)),
                          pvalue_t12_feature = numeric(length(all_genes)),
                          correlation_t24_feature = numeric(length(all_genes)),
                          pvalue_t24_feature = numeric(length(all_genes)),
                          correlation_t48_feature = numeric(length(all_genes)),
                          pvalue_t48_feature = numeric(length(all_genes)),
                         stringsAsFactors = FALSE)
   
  # Loop through each gene
  for (i in seq_along(all_genes)) {
    gene <- all_genes[i]
  
    # Get gene expression data for the current gene
    genedata <- as.matrix(tapply(v$E[gene, ], list(sampleid, group), mean))
    genedata <- genedata[, desired_order]
    genedata[, 1:9] <- genedata[, 1:9] - genedata[, 1]
    genedata <- genedata[, 2:9]
    colnames(genedata) <- c("MID", "0", "3", "6", "9", "12", "24", "48")
    genedata <- genedata[- rowsrna, ]

    # Calculate features
    peakfcup <- apply(genedata, 1, max)
    peakfcdown <- apply(genedata, 1, min)
    avgfc <- rowMeans(genedata)
    genestdev <- apply(genedata, 1, sd)
    timeMID <- genedata[, "MID"]
    time0 <- genedata[, "0"]
    time3 <- genedata[, "3"]
    time6 <- genedata[, "6"]
    time9 <- genedata[, "9"]
    time12 <- genedata[, "12"]
    time24 <- genedata[, "24"]
    time48 <- genedata[, "48"]
    
proteinchange <- chapter4results %>% group_by(ID) %>%
  mutate(change = ((( {{WB}} [TIME == "POST"] / {{WB}} [TIME == "PRE"]) - 1) * 100))
proteinchange <- unique(proteinchange$change)
proteinchange <- na.omit(proteinchange)

    # Calculate AUC using the trapezoidal rule
    calculate_auc_trapz <- function(row) {
      x <- as.numeric(colnames(genedata))[-1] 
      y <- as.numeric(row[-1])                
      auc <- trapz(x, y)
      return(auc)
    }
    auc <- apply(genedata, 1, calculate_auc_trapz)
  
    # Calculate correlations with feature and their p-values
    cor_test <- function(x, y) {
      cor_val <- cor.test(x, y)$estimate
      p_val <- cor.test(x, y)$p.value
      return(list(cor_val, p_val))
    }
    
    c_peakfcup <- cor_test(peakfcup, proteinchange)
    c_peakfcdown <- cor_test(peakfcdown, proteinchange)
    c_avgfc <- cor_test(avgfc, proteinchange)
    c_genestdev <- cor_test(genestdev, proteinchange)
    c_auc <- cor_test(auc, proteinchange)
    
c_MID <- if (gene %in% rownames(MIDvsPRE)) {
  cor_test(timeMID, proteinchange)
} else {
  list(NA, NA)
}

c_t0 <- if (gene %in% rownames(POSTvsPRE)) {
  cor_test(time0, proteinchange)
} else {
  list(NA, NA)
}
    
    
   c_t3 <- if (gene %in% rownames(H3vsPRE)) {
  cor_test(time3, proteinchange)
} else {
  list(NA, NA)
}

c_t6 <- if (gene %in% rownames(H6vsPRE)) {
  cor_test(time6, proteinchange)
} else {
  list(NA, NA)
}

c_t9 <- if (gene %in% rownames(H9vsPRE)) {
  cor_test(time9, proteinchange)
} else {
  list(NA, NA)
}

c_t12 <- if (gene %in% rownames(H12vsPRE)) {
  cor_test(time12, proteinchange)
} else {
  list(NA, NA)
}

c_t24 <- if (gene %in% rownames(H24vsPRE)) {
  cor_test(time24, proteinchange)
} else {
  list(NA, NA)
}

c_t48 <- if (gene %in% rownames(H48vsPRE)) {
  cor_test(time48, proteinchange)
} else {
  list(NA, NA)
}

    # Store results for the current gene in the data frame
    features[i, ] <- list(gene = gene,
                          correlation_peakfcup_feature = c_peakfcup[[1]],
                          pvalue_peakfcup_feature = c_peakfcup[[2]],
                          correlation_peakfcdown_feature = c_peakfcdown[[1]],
                          pvalue_peakfcdown_feature = c_peakfcdown[[2]],
                          correlation_avgfc_feature = c_avgfc[[1]],
                          pvalue_avgfc_feature = c_avgfc[[2]],
                          correlation_genestdev_feature = c_genestdev[[1]],
                          pvalue_genestdev_feature = c_genestdev[[2]],
                          correlation_auc_feature = c_auc[[1]],
                          pvalue_auc_feature = c_auc[[2]],
                          correlation_tMID_feature = c_MID[[1]],
                          pvalue_tMID_feature = c_MID[[2]],
                          correlation_t0_feature = c_t0[[1]],
                          pvalue_t0_feature = c_t0[[2]],
                          correlation_t3_feature = c_t3[[1]],
                          pvalue_t3_feature = c_t3[[2]],
                          correlation_t6_feature = c_t6[[1]],
                          pvalue_t6_feature = c_t6[[2]],
                          correlation_t9_feature = c_t9[[1]],
                          pvalue_t9_feature = c_t9[[2]],
                          correlation_t12_feature = c_t12[[1]],
                          pvalue_t12_feature = c_t12[[2]],
                          correlation_t24_feature = c_t24[[1]],
                          pvalue_t24_feature = c_t24[[2]],
                          correlation_t48_feature = c_t48[[1]],
                          pvalue_t48_feature = c_t48[[2]])
  }
  
  return(features)
}

CIrows <- c(12,22,26)
CIIrows <- c(12,22,26)
CIIIrows <- c(12,22,26)
CIVrows <- c(12,22,26)
CVrows <- c(6,12,22,26)

CI <- genefeatures(CI, "NDUFB8", CIrows)
CII <- genefeatures(CII, "SDHB", CIIrows)
CIII <- genefeatures(CIII, "UQCRC2", CIIIrows)
CIV <- genefeatures(CIV, "COX4I1", CIVrows)
CV <- genefeatures(CV, "ATP5F1A", CVrows)

oxphos <- rbind(CI, CII, CIII, CIV, CV)

oxphos <- oxphos %>%
  pivot_longer(
    cols = -gene,
    names_to = "variable",
    values_to = "value") %>%
  separate(variable, into = c("type", "index"), sep = "_")

oxphos <- oxphos %>%
  pivot_wider(names_from = type, values_from = value)

replacements <- c("tMID" = "MID", "t0" = "POST", "t3" = "3H", "t6" = "6H", "t9" = "9H", "t12" = "12H", "t24" = "24H", "t48" = "48H", "peakfcup" = "Peak FC up", "peakfcdown" = "Peak FC down", "avgfc" = "Average FC", "genestdev" = "Standard deviation", "auc" = "AUC")

df <- oxphos %>%
  mutate(index = case_when(
    index %in% names(replacements) ~ replacements[index],
    TRUE ~ index))

df <- df %>% 
  mutate(direction = ifelse(correlation < 0, "-", "+"))

brewer_pal4 <-  brewer.pal(9, "Set1")
brewer_pal4 <- brewer_pal4[-1]
brewer_pal3 <-  brewer.pal(5, "Set3")

correlation_cols <- c(brewer_pal4, brewer_pal3)

df$gene <- as.character(df$gene)
df$gene <- factor(df$gene, levels = rev(c("NDUFB8", "SDHB", "UQCRC2", "COX4I1", "ATP5F1A")))

df$index <- as.character(df$index)
df$index <- factor(df$index, levels = replacements)

df <- df %>%
  mutate(direction = ifelse(is.na(direction), "None", direction))

direction_levels <- c("+", "-")

ggplot(df, aes(x = index, y = gene, size = abs(correlation), color = index, shape=direction)) +
  geom_point() +
  geom_text(aes(label = round(pvalue, 3)), size = 3, color = "black", vjust = -2) +
  geom_text(data = dplyr::filter(df, direction %in% direction_levels),
            aes(label = direction), size = 8, color = "black", vjust = 0.4) +
  scale_colour_manual(values = correlation_cols) +
  scale_size_continuous(range = c(1, 12)) +
  scale_shape_manual(values=c(16,16,16), labels= c("-" = "Negative", "+" = "Positive", "None" = "")) +
  guides(color = "none", shape = guide_legend(title = "Direction",
                                              override.aes = list(shape = c(45,43,NA),
                                                                  size = 6, reverse=TRUE))) +
  labs(x = NULL, y = "OXPHOS complex subunits", color = "Index",
       size = "Pearson correlation R",
       title = expression("Correlation between gene expression and changes in OXPXOS complex subunit protein content")) +
  scale_x_discrete(guide = guide_axis(angle = 45)) +
  theme(
  axis.title.y = element_text(margin = ggplot2::margin(l = 5, r =5))) +
  theme_bw()

COX4I1correlation <- as.matrix(tapply(v$E["COX4I1", ], 
                                        list(sampleid, group), 
                                        mean))
rows_to_remove <- c(12,22,26)
COX4I1correlation <- COX4I1correlation[-rows_to_remove, ]

desired_order <- c(5,2,4,7,6,3,8,9,1)
COX4I1correlation  <- COX4I1correlation [, desired_order]

COX4I1correlation[, 1:9] <- COX4I1correlation[, 1:9] - COX4I1correlation[, 1]
COX4I1correlation <- COX4I1correlation[, 2:9]
COX4I1correlation <- as.data.frame(COX4I1correlation)
colnames(COX4I1correlation) <- c("MID", "0", "3", "6", "9", "12", "24", "48")

 calculate_auc_trapz <- function(row) {
      x <- as.numeric(colnames(COX4I1correlation))[-1] 
      y <- as.numeric(row[-1])                
      auc <- trapz(x, y)
      return(auc)
    }

COX4I1AUC <- apply(COX4I1correlation, 1, calculate_auc_trapz)

COX4I1proteinchange <- chapter4results %>% group_by(ID) %>%
  mutate(change = ((( CIV[TIME == "POST"] / CIV[TIME == "PRE"]) - 1) * 100))
COX4I1proteinchange <- unique(COX4I1proteinchange$change)
COX4I1proteinchange <- na.omit(COX4I1proteinchange)

COX4I1correlation <- cbind(COX4I1AUC, COX4I1proteinchange)  %>% as.data.frame
colnames(COX4I1correlation) <- c("COX4I1AUC", "Protein")

COX4I1correlation <- COX4I1correlation %>%
  pivot_longer(cols = c("COX4I1AUC"), 
               names_to = "feature", 
               values_to = "value")

ggplot(COX4I1correlation, aes(x = value, y = Protein, colour = feature)) + 
  geom_vline(xintercept = 0, linetype = "dashed", colour = "black") +
  geom_hline(yintercept = 0, linetype = "dashed", colour = "black") +
  stat_cor(aes(y = Protein, x = value, colour = feature),
           inherit.aes = FALSE, size = 6,
           label.x = -45, label.y = 250) + 
  geom_smooth(method = "lm", se = FALSE, size = 2) +
  geom_point(aes(fill = feature), size = 5, shape = 21, color = "black") + 
  labs(y = "Change in protein content (%)",
       x = expression(paste(Log[2]~"FC relative to PRE" )),
       colour = "Gene feature") +
  scale_colour_manual(values=c("COX4I1AUC" = "#80B1D3"), label = c("COX4I1AUC" = "AUC")) +
  scale_fill_manual(values=c("COX4I1AUC" = "#80B1D3"), label = c("COX4I1AUC" = "AUC")) +
  ggtitle("Correlation between COX4I1 expression and changes in protein content") +
  theme_bw() +
  theme(axis.title.x = element_text(vjust = 2, size = 12),
        axis.title.y = element_text(vjust = 2, size = 12)) +
   scale_x_continuous(expand = expansion(mult = c(0, 0)), limits= c(-50, 12),breaks = seq(-50, 10, by = 10)) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(-110, 275),breaks = seq(-100, 250, by = 50)) +
  guides(
    colour = "none",
    fill = guide_legend(
     title = "Gene feature",
      labels = c("Area under the curve")))
```

#Correlation between mRNA and protein content changes (Fig 4.8B & 4.8D - Fission/fusion regulators)
```{r}
DRP1rows <- c(12,22,26)
FIS1rows <- c(12,22,26)
MFN2rows <- c(12,22,26)
OPA1rows <- c(12,22,26)

DRP1 <- genefeatures(DRP1WB, "DNM1L", DRP1rows)
FIS1 <- genefeatures(FIS1WB, "FIS1", FIS1rows)
MFN2 <- genefeatures(MFN2WB, "MFN2", MFN2rows)
OPA1 <- genefeatures(OPA1WB, "OPA1", OPA1rows)

fisregulators <- rbind(DRP1, FIS1, MFN2, OPA1)

 result_df2 <- fisregulators %>%
  pivot_longer(
    cols = -gene,
    names_to = "variable",
    values_to = "value") %>%
  separate(variable, into = c("type", "index"), sep = "_")

result_df2 <- result_df2 %>%
  pivot_wider(names_from = type, values_from = value)

replacements <- c("tMID" = "MID", "t0" = "POST", "t3" = "3H", "t6" = "6H", "t9" = "9H", "t12" = "12H", "t24" = "24H", "t48" = "48H", "peakfcup" = "Peak FC up", "peakfcdown" = "Peak FC down", "avgfc" = "Average FC", "genestdev" = "Standard deviation", "auc" = "AUC")

df2 <- result_df2 %>%
  mutate(index = case_when(
    index %in% names(replacements) ~ replacements[index],
    TRUE ~ index))

df2 <- df2 %>% 
  mutate(direction = ifelse(correlation > 0, "+", "-"))

brewer_pal4 <-  brewer.pal(9, "Set1")
brewer_pal4 <- brewer_pal4[-1]
correlation_cols <- c(brewer_pal4, brewer_pal3)

df2$gene <- as.character(df2$gene)
df2$gene <- factor(df2$gene, levels = rev(c("DNM1L", "FIS1", "MFN2", "OPA1")))

df2$index <- as.character(df2$index)
df2$index <- factor(df2$index, levels = replacements)

df2 <- df2 %>%
  mutate(direction = ifelse(is.na(direction), "None", direction))

direction_levels <- c("+", "-")

ggplot(df2, aes(x = index, y = gene, size = abs(correlation), color = index, shape=direction)) +
  geom_point() +
  geom_text(aes(label = round(pvalue, 3)), size = 3, color = "black", vjust = -2) +
  geom_text(data = dplyr::filter(df2, direction %in% direction_levels),
            aes(label = direction), size = 8, color = "black", vjust = 0.4) +
  scale_colour_manual(values = correlation_cols) +
  scale_size_continuous(range = c(1, 12)) +
  scale_shape_manual(values=c(16,16,16),
                     labels= c("-" = "Negative", "+" = "Positive", "None" = "")) +
  guides(color = "none", shape = guide_legend(title = "Direction",
                                              override.aes = list(shape = c(45,43,NA),
                                              size = 6, reverse=TRUE))) +
  theme_bw() +
  labs(x = NULL, y = "Regulators of mitochondrial fission and fusion",
       size = "Pearson correlation R",
       title = expression("Correlation between gene expression and changes in fission and fussion regulator protein content")) +
  theme(
  axis.title.y = element_text(margin = ggplot2::margin(l = 5, r =5))) +
  scale_x_discrete(guide = guide_axis(angle = 45))

FIS1correlation <- as.matrix(tapply(v$E["FIS1", ], 
                                        list(sampleid, group), 
                                        mean))
rows_to_remove <- c(12,22,26)
FIS1correlation <- FIS1correlation[-rows_to_remove, ]

desired_order <- c(5,2,4,7,6,3,8,9,1)
FIS1correlation  <- FIS1correlation [, desired_order]

FIS1correlation[, 1:9] <- FIS1correlation[, 1:9] - FIS1correlation[, 1]
FIS1correlation <- FIS1correlation[, 2:9]
FIS1correlation <- as.data.frame(FIS1correlation)
FIS1peakfdown <- apply(FIS1correlation, 1, min)
FIS1genestdev <- apply(FIS1correlation, 1, sd)

FIS1proteinchange <- chapter4results %>% group_by(ID) %>%
  mutate(change = ((( FIS1WB[TIME == "POST"] / FIS1WB[TIME == "PRE"]) - 1) * 100))
FIS1proteinchange <- unique(FIS1proteinchange$change)
FIS1proteinchange <- na.omit(FIS1proteinchange)

FIS1correlation <- cbind(FIS1peakfdown, FIS1genestdev, FIS1proteinchange)  %>% as.data.frame
colnames(FIS1correlation) <- c("FIS1peakfcdown", "FIS1genestdev", "Protein")

FIS1correlation <- FIS1correlation %>%
  pivot_longer(cols = c("FIS1peakfcdown", "FIS1genestdev"), 
               names_to = "feature", 
               values_to = "value")
brewer_pal3

ggplot(FIS1correlation, aes(x = value, y = Protein, colour = feature)) + 
  geom_vline(xintercept = 0, linetype = "dashed", colour = "black") +
  geom_hline(yintercept = 0, linetype = "dashed", colour = "black") +
  stat_cor(FIS1correlation %>% dplyr::filter(feature == "FIS1genestdev"),
           mapping = aes(y = Protein, x = value, colour = feature),
           inherit.aes = FALSE, size = 6,
           label.x = -1.45, label.y = 70) +
  stat_cor(FIS1correlation %>% dplyr::filter(feature == "FIS1peakfcdown"),
           mapping = aes(y = Protein, x = value, colour = feature),
           inherit.aes = FALSE, size = 6,
           label.x = -1.45, label.y = 46) + 
  geom_smooth(method = "lm", se = FALSE, size = 2) +
  geom_point(aes(fill = feature), size = 5, shape = 21, color = "black") + 
  labs(y = "Change in protein content (%)", x = expression(paste(Log[2]~"FC relative to PRE" )),
       colour = "Gene feature") +
  scale_colour_manual(values = c("FIS1peakfcdown" = "#f2f274", "FIS1genestdev" = "#FB8072"),
                      labels = c("FIS1peakfcdown" = "Peak FC down",
                                 "FIS1genestdev" = "Standard deviation")) +
  scale_fill_manual(values = c("FIS1peakfcdown" = "#f2f274", "FIS1genestdev" = "#FB8072"),
                    labels = c("FIS1peakfcdown" = "Peak FC down",
                               "FIS1genestdev" = "Standard deviation")) +
  ggtitle("Correlation between FIS1 expression and changes in protein content") +
  theme_bw() +
  scale_x_continuous(expand = expansion(mult = c(0, 0)), limits= c(-1.5, 0.5),breaks = seq(-1.5, 0.5, by = 0.5)) +
  scale_y_continuous(expand = expansion(mult = c(0, 0)), limits= c(-35, 90),breaks = seq(-30, 90, by = 30)) +
  theme(axis.title.x = element_text(vjust = 2, size = 12),
        axis.title.y = element_text(vjust = 2, size = 12)) +
  guides(
    colour = "none",
    fill = guide_legend(
      title = "Gene feature",
      labels = c("Peak FC down", "Standard deviation")))
```
